<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:con="http://www.bea.com/wli/sb/stages/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isAutoPublish="false" isTracingEnabled="false" xmlns:ser="http://www.bea.com/wli/sb/services">
    <ser:description>ManageOrder Business Service provides operations which allow retrieval of list of orders, complete details of a given order 
present in the order management system.Archive order retrieval is also supported if opted for by the consuming client. 
This service also allows submission of new hardware orders.This also enables to set/update the status of the consignment/despatch
 in an order by retail systems.
It has six operations:
1)GetOrderDetails  
2)GetOrderList  
3) SubmitInstallOrder
4) GetOrderList_2
5) GetOrderDetails_2
6) ConfirmOrderTradeInCollection _1</ser:description>
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType" xmlns:con="http://www.bea.com/wli/sb/services/bindings/config">
      <con:wsdl ref="NorthBoundInterfaces/manageorderservice_2_0"/>
      <con:port>
        <con:name>ManageOrderPort</con:name>
        <con:namespace>http://soa.o2.co.uk/manageorderservice_2</con:namespace>
      </con:port>
      <con:selector type="SOAP body"/>
    </ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
  </ser:coreEntry>
  <ser:endpointConfig xmlns:ser="http://www.bea.com/wli/sb/services">
    <tran:provider-id>http</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:URI>
      <env:value xmlns:env="http://www.bea.com/wli/config/env">/services/ManageOrder_2_0</env:value>
    </tran:URI>
    <tran:inbound-properties/>
    <tran:all-headers>false</tran:all-headers>
    <tran:provider-specific xsi:type="http:HttpEndPointConfiguration">
      <http:inbound-properties>
        <http:use-https>true</http:use-https>
      </http:inbound-properties>
    </tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-5717877515595668264--4685988c.1279332c8f0.-7ff6" xmlns:ser="http://www.bea.com/wli/sb/services">
    <con:pipeline type="request" name="GetOrderList_3 Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate GetOredrList_3 Request ">
        <con:comment>Validating GetOredrList_3 Request against NorthBoundInterfaces/manageorderdata_2_0.xsd</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2359128528684647591--7c882c5e.149cd05379a.-7fae</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:getOrderList_3</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:getOrderList_3</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Save Request">
        <con:comment>Save the incomming request</con:comment>
        <con:context/>
        <con:actions>
          <con1:assign varName="getOrderListRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2583345757981505240--31f65227.14cc15cc835.-8000</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
          </con1:assign>
        </con:actions>
      </con:stage>
      <con:stage name="Construct getOrderList_3 Request">
        <con:comment>Constructing  the request to getOrderList( ) Service from the ManageOrder: getOrderList_3 Request</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2359128528684647591--7c882c5e.149cd05379a.-7fab</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/GetOrderList_3RQToUtilGetOrderListV4RQ"/>
                <con2:param name="getOrderList_3">
                  <con2:path>$body/man:getOrderList_3</con2:path>
                </con2:param>
                <con2:param name="header">
                  <con2:path>$incomingHeader</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="SubmitOrder Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Saving the incoming request">
        <con:comment>Saving the incoming request.</con:comment>
        <con:context/>
        <con:actions>
          <con1:assign varName="submitOrderRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7235988071129991800--6e9193b5.13e3b34e494.-7fff</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
          </con1:assign>
        </con:actions>
      </con:stage>
      <con:stage name="Validate SubmitOrder Request">
        <con:comment>Validates the request against the Northbound xsd, for the SubmitOrder request.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7ff3</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:submitOrder</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:submitOrder</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Construct SubmitInstallOrder Request">
        <con:comment>Construct the request as expected by the SubmitInstallOrderTechnical Service.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check if the OrderType is 'NE' then construct the request else throw an error.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-901413749672648104--3e71c9e4.127ad678d27.-7ffc</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/man:submitOrder/man:orderHeader/man:orderType)=$configXML/orderType</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3442113482793664813-2e86b5be.127ad320a2d.-8000</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/SubmitOrderRQtoSubmitInstallOrderRQ"/>
                      <con2:param name="submitOrder">
                        <con2:path>$body/man:submitOrder</con2:path>
                      </con2:param>
                      <con2:param name="configData">
                        <con2:path>$configXML</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
                <con1:replace varName="maskedRequest" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c63</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/SubmitOrderRQtoSubmitInstallOrderRQ"/>
                      <con2:param name="submitOrder">
                        <con2:path>$maskedRequest</con2:path>
                      </con2:param>
                      <con2:param name="configData">
                        <con2:path>$configXML</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:Error>
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-901413749672648104--3e71c9e4.127ad678d27.-7ffa</con2:id>
                <con1:errCode>manageorder-36600-3075-E</con1:errCode>
                <con1:message>Submission of only New order is currently supported. Please select orderType as NE and resend.</con1:message>
              </con1:Error>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Call To SubmitInstallOrder.submitInstallOrder">
        <con:comment>Invoke the  SubmitInstallOrder.submitInstallOrder operation which inturn calls the CUK backend.</con:comment>
        <con:context/>
        <con:actions>
          <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7235988071129991800--6e9193b5.13e3b34e494.-8000</con2:id>
            <con1:service xsi:type="ref:ProxyRef" ref="SubmitInstallOrder_1_0/proxyservices/SubmitInstallOrder_1_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con1:operation>submitInstallOrder</con1:operation>
            <con1:request>
              <con1:body wrapped="true">$body</con1:body>
              <con1:header>$incomingHeader</con1:header>
            </con1:request>
            <con1:response>
              <con1:body wrapped="true">body</con1:body>
              <con1:header>header</con1:header>
            </con1:response>
            <con1:requestTransform>
              <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-901413749672648104--3e71c9e4.127ad678d27.-7ffe</con3:id>
                <con3:archive ref="Utility/o2framework/o2framework"/>
                <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                <con3:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$maskedRequest/*</con4:xqueryText>
                </con3:expr>
              </con3:javaCallout>
            </con1:requestTransform>
            <con1:responseTransform>
              <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-901413749672648104--3e71c9e4.127ad678d27.-7fff</con3:id>
                <con3:archive ref="Utility/o2framework/o2framework"/>
                <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                <con3:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$body</con4:xqueryText>
                </con3:expr>
              </con3:javaCallout>
              <con1:assign varName="submitInstallOrderResponse">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6752155753960056312--291be6e9.13e5569fae1.-8000</con2:id>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                </con1:expr>
              </con1:assign>
            </con1:responseTransform>
          </con1:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Call to ManageOnlineRegistration_1_0.updateOnlineAccount_2" errorHandler="_onErrorHandler-7235988071129991800--6e9193b5.13e3b34e494.-7ff2">
        <con:comment>If the response status=SUCCESSFUL,
If address1stLine of existingParty=Not Set and timeslot is not CLICK_CLLCT,
then make a call to ManageOnlineRegistration_1_0.updateOnlineAccount_2 operation.
else
If Order is Postpay installation, call to ManageOnlineRegistration_1_0.updateOnlineAccount_2 operation
else
Do not call and construct the final response.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/submitinstallorderdata_1" prefix="sub" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="mod" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If the CUK response status=SUCCESSFUL,
proceed to next step
else
construct final response.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7235988071129991800--6e9193b5.13e3b34e494.-7ff8</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($submitInstallOrderResponse/sub:submitInstallOrderResponse/sub:acceptStatus)=data($configXML/successStatusCode/successStatus)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:ifThenElse>
                  <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If address1stLine of existingParty=Not Set and timeslot is not CLICK_CLLCT,
then make a call to ManageOnlineRegistration_1_0.updateOnlineAccount_2 operation.
else
If Order is Postpay installation, call to ManageOnlineRegistration_1_0.updateOnlineAccount_2 operation</con2:comment>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7235988071129991800--6e9193b5.13e3b34e494.-7fef</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:lower-case(data($submitOrderRequest/mod:submitOrder/mod:partySet[1]/mod:existingParty/mod:currentAddress/mod:address1stLine))=fn:lower-case(data($configXML/notSet))
and
fn:not((data($submitOrderRequest/mod:submitOrder/mod:orderDeliveryDetails/mod:chargeableDeliveryOption/mod:timeslot)=data($configXML/clickAndCollect)) or (data($submitOrderRequest/mod:submitOrder/mod:orderDeliveryDetails/mod:chargeableDeliveryOption/mod:timeslot)=data($configXML/clickAndCollectNow)))</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:replace contents-only="true" varName="body">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7235988071129991800--6e9193b5.13e3b34e494.-7fee</con2:id>
                        <con1:location>
                          <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                        </con1:location>
                        <con1:expr>
                          <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                            <con2:resource ref="ManageOrder_2_0/transformations/SubmitOrderRequestToUpdateOnlineAccount_2Request"/>
                            <con2:param name="submitOrder">
                              <con2:path>$submitOrderRequest/mod:submitOrder</con2:path>
                            </con2:param>
                            <con2:param name="address">
                              <con2:path>'deliveryAddress'</con2:path>
                            </con2:param>
                            <con2:param name="configXml">
                              <con2:path>$configXML</con2:path>
                            </con2:param>
                          </con2:xqueryTransform>
                        </con1:expr>
                      </con1:replace>
                    </con1:actions>
                  </con1:case>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:not(fn:lower-case(data($submitOrderRequest/mod:submitOrder/mod:partySet[1]/mod:existingParty/mod:currentAddress/mod:address1stLine))=fn:lower-case(data($configXML/notSet)))
and
fn:not((data($submitOrderRequest/mod:submitOrder/mod:orderDeliveryDetails/mod:timeslot)=data($configXML/clickAndCollect)) or (data($submitOrderRequest/mod:submitOrder/mod:orderDeliveryDetails/mod:chargeableDeliveryOption/mod:timeslot)=data($configXML/clickAndCollectNow)))
and
fn:exists($submitOrderRequest/mod:submitOrder/mod:saleableProducts/mod:mobileAssignedProduct/mod:postpaySim)</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:replace contents-only="true" varName="body">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c62</con2:id>
                        <con1:location>
                          <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                        </con1:location>
                        <con1:expr>
                          <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                            <con2:resource ref="ManageOrder_2_0/transformations/SubmitOrderRequestToUpdateOnlineAccount_2Request"/>
                            <con2:param name="submitOrder">
                              <con2:path>$submitOrderRequest/mod:submitOrder</con2:path>
                            </con2:param>
                            <con2:param name="address">
                              <con2:path>'currentAddress'</con2:path>
                            </con2:param>
                            <con2:param name="configXml">
                              <con2:path>$configXML</con2:path>
                            </con2:param>
                          </con2:xqueryTransform>
                        </con1:expr>
                      </con1:replace>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:comment>If neither address1stLine=Not Set nor Order is Postpay installation,
then skip the call and constuct final response.</con2:comment>
                      <con2:id>_ActionId-7235988071129991800--6e9193b5.13e3b34e494.-7fec</con2:id>
                    </con2:skip>
                  </con1:default>
                </con1:ifThenElse>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7235988071129991800--6e9193b5.13e3b34e494.-7ff6</con2:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="ManageOnlineRegistration_1_0/proxyservices/ManageOnlineRegistration_1_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>updateOnlineAccount_2</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$incomingHeader</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">updateOnlineAccount_2Response</con1:body>
                    <con1:header>header</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c61</con3:id>
                      <con3:archive ref="Utility/o2framework/o2framework"/>
                      <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                      <con3:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$body</con4:xqueryText>
                      </con3:expr>
                    </con3:javaCallout>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c60</con3:id>
                      <con3:archive ref="Utility/o2framework/o2framework"/>
                      <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                      <con3:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$updateOnlineAccount_2Response</con4:xqueryText>
                      </con3:expr>
                    </con3:javaCallout>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="getOrderSummary_1_Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"/>
    <con:pipeline type="request" name="SubmitUpgradeOrder_1 Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate  SubmitUpgradeOrder_1 Request">
        <con:comment>Validate  SubmitUpgradeOrder_1 Request against the Northbound xsd</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-403800558557879529--5167c2d1.1326d03769d.-8000</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:submitUpgradeOrder_1</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:submitUpgradeOrder_1</con2:xpathText>
            </con1:location>
          </con1:validate>
          <con1:assign varName="cardIssuer" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1058132764896945175-28ef5d49.137363feeff.-8000</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if(data($body/man:submitUpgradeOrder_1/man:initialPaymentDetails/man:paymentThroughCard/man:cardDetails/man:cardIssuer))then
data($body/man:submitUpgradeOrder_1/man:initialPaymentDetails/man:paymentThroughCard/man:cardDetails/man:cardIssuer)
else ""</con2:xqueryText>
            </con1:expr>
          </con1:assign>
        </con:actions>
      </con:stage>
      <con:stage name="Request Validation">
        <con:comment>Chacking whether upgradePromotionsTaken or upgradeCustomerPromotions is coming in request.</con:comment>
        <con:context>
          <con4:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8915375421776074876-7bc7f012.15ec2fa3bf0.-7f6c</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$body/man:submitUpgradeOrder_1/man:upgradePromotionsTaken and $body/man:submitUpgradeOrder_1/man:upgradeCustomerPromotions</con4:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:Error>
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8915375421776074876-7bc7f012.15ec2fa3bf0.-7f4b</con4:id>
                  <con2:errCode>manageorder-36600-4501-V</con2:errCode>
                  <con2:message>UpgradePromotionsTaken is deprecated, please supply the upgradeCustomerPromotions in the request.</con2:message>
                </con2:Error>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Construct SubmitUpgradeRequest_1 Request">
        <con:comment>Construct submitUpgradeOrder_1 Request to invoke CUK backend</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-403800558557879529--5167c2d1.1326d03769d.-7fff</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/ConstructSubmitUpgradeOrder_1RQ"/>
                <con2:param name="configXML">
                  <con2:path>$configXML</con2:path>
                </con2:param>
                <con2:param name="cardCv2Value">
                  <con2:path>$configXML/cardCv2Value</con2:path>
                </con2:param>
                <con2:param name="submitUpgradeOrder_1">
                  <con2:path>$body/man:submitUpgradeOrder_1</con2:path>
                </con2:param>
                <con2:param name="countryNamePolitical">
                  <con2:path>$configXML/countryNamePolitical</con2:path>
                </con2:param>
                <con2:param name="header">
                  <con2:path>$incomingHeader</con2:path>
                </con2:param>
                <con2:param name="cardIssuer">
                  <con2:path>if(data($cardIssuer))then
data($configXML/cardIssuerType/cardIssuers[cardIssuer=$cardIssuer]/value)
else ""</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
          <con1:replace varName="maskedRequest" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c43</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/ConstructSubmitUpgradeOrder_1RQ"/>
                <con2:param name="configXML">
                  <con2:path>$configXML</con2:path>
                </con2:param>
                <con2:param name="cardCv2Value">
                  <con2:path>$configXML/cardCv2Value</con2:path>
                </con2:param>
                <con2:param name="submitUpgradeOrder_1">
                  <con2:path>$maskedRequest</con2:path>
                </con2:param>
                <con2:param name="countryNamePolitical">
                  <con2:path>$configXML/countryNamePolitical</con2:path>
                </con2:param>
                <con2:param name="cardIssuer">
                  <con2:path>if(data($cardIssuer))then
fn:replace(data($configXML/cardIssuerType/cardIssuers[cardIssuer=$cardIssuer]/value),'.','*')
else ""</con2:path>
                </con2:param>
                <con2:param name="header">
                  <con2:path>$incomingHeader</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="Common Logging Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Logging Response">
        <con:comment>If Sensitive data is coming in the response then transform with the
 masked data variable and use that variable for logging, else transform 
with the body and log the body.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderdetailsdata_1" prefix="util" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:javaCallout varName="header" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1785197753183808035--2f289a47.127fbc443a2.-7ffe</con2:id>
            <con1:archive ref="Utility/o2framework/o2framework"/>
            <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
            <con1:method>public static org.apache.xmlbeans.XmlObject logExit(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
            </con1:expr>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
            </con1:expr>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
          </con1:javaCallout>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="GetOrderList Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate GetOrderList Request">
        <con:comment>Validates the request against the Northbound xsd, for the GetOrderList request.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7ff4</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:getOrderList</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:getOrderList</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Custom Validation">
        <con:comment>Validates request as required from business point of view.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If archive retreival flag is set and msisdn is not provided in
the request then, raise an error as data can be retreived
based on msisdn from Archival Platform.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5875112021626571551-7e455e97.1285d42cc63.-8000</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/man:getOrderList/man:isArchiveOrderRequired) = data($configXML/TrueValue)
and
fn:string-length(data($body/man:getOrderList/man:msisdn)) = 0</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:Error>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5875112021626571551-7e455e97.1285d42cc63.-7fff</con2:id>
                  <con1:errCode>manageorder-36600-4001-V</con1:errCode>
                  <con1:message>Archive Order retrieval is supported only for a MSISDN.</con1:message>
                </con1:Error>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Call Technical Service UtilGetOrderList ">
        <con:comment>Constructs UtilGetOrderList_1_0.utilGetOrderList request and 
invokes UtilGetOrderList_1_0.utilGetOrderList operation 
and logs the outbound and inbound respectively.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fe3</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/GetOrderListRQToUtilGetOrderListRQ"/>
                <con2:param name="portalDomain">
                  <con2:path>data($configXML/portalDomain)</con2:path>
                </con2:param>
                <con2:param name="getOrderList">
                  <con2:path>$body/man:getOrderList</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
          <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5875112021626571551-7e455e97.1285d42cc63.-7ffe</con2:id>
            <con1:service xsi:type="ref:ProxyRef" ref="UtilGetOrderList_1_0/proxyservices/UtilGetOrderList_1_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con1:operation>utilGetOrderList</con1:operation>
            <con1:request>
              <con1:body wrapped="true">$body</con1:body>
              <con1:header>$header</con1:header>
            </con1:request>
            <con1:response>
              <con1:body wrapped="true">utilGetOrderListResponse</con1:body>
              <con1:header>header</con1:header>
            </con1:response>
            <con1:requestTransform>
              <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fe1</con3:id>
                <con3:archive ref="Utility/o2framework/o2framework"/>
                <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                <con3:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                </con3:expr>
              </con3:javaCallout>
            </con1:requestTransform>
            <con1:responseTransform>
              <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c4a</con3:id>
                <con3:archive ref="Utility/o2framework/o2framework"/>
                <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                <con3:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$utilGetOrderListResponse</con4:xqueryText>
                </con3:expr>
              </con3:javaCallout>
            </con1:responseTransform>
          </con1:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Call Adapter Service OrderEnquiry" errorHandler="_onErrorHandler-5875112021626571551-7e455e97.1285d42cc63.-7fe5">
        <con:comment>Constructs OrderEnquiry_1_0.getArchiveOrderList
request and invokes OrderEnquiry_1_0.getArchiveOrderList
operation and logs the outbound and inbound respectively.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderlistdata_1" prefix="gol" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/orderenquirydata_1" prefix="oed" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Call the OrderEnquiry Adapter service if consuming 
application has set the flag and orders returned by 
UtilGetOrderList Service are less than order requested.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5875112021626571551-7e455e97.1285d42cc63.-7ff7</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($incomingRequest/man:getOrderList/man:isArchiveOrderRequired) = data($configXML/TrueValue)
and
xs:integer(data($utilGetOrderListResponse/gol:utilGetOrderListResponse/gol:ordersReturned)) &lt; xs:integer(data($incomingRequest/man:getOrderList/man:ordersSelectionCriteria/man:numOrdersRequired))</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace contents-only="true" varName="body">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5875112021626571551-7e455e97.1285d42cc63.-7ff6</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/GetOrderListRQToGetArchiveOrderListRQ"/>
                      <con2:param name="msisdn">
                        <con2:path>data($incomingRequest/man:getOrderList/man:msisdn)</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5875112021626571551-7e455e97.1285d42cc63.-7fec</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="ManageOrder_2_0/businessservices/OrderEnquiry_1_0_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getArchiveOrderList</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$header</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">getArchiveOrderListResponse</con1:body>
                    <con1:header>header</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c49</con3:id>
                      <con3:archive ref="Utility/o2framework/o2framework"/>
                      <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                      <con3:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                      </con3:expr>
                    </con3:javaCallout>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c48</con3:id>
                      <con3:archive ref="Utility/o2framework/o2framework"/>
                      <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                      <con3:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$getArchiveOrderListResponse</con4:xqueryText>
                      </con3:expr>
                    </con3:javaCallout>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-7235988071129991800--6e9193b5.13e3b34e494.-7ff2" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Error handling for updateOnlineAccount_2 Operation.">
        <con:comment>Always return a success response from submitOrder operation on receiving either success or fault response from updateOnlineAccount_2. 
Thus any failure response from updateOnlineAccount_2 should be ignored.</con:comment>
        <con:context/>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If ManageOnlineRegistration_1_0.updateOnlineAccount_2 Operation, throws a fault,
then ignore and continue.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7235988071129991800--6e9193b5.13e3b34e494.-7ff1</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:local-name($updateOnlineAccount_2Response/*[1])="Fault"</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con2:resume xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                  <con2:comment>Resume and construct the final response.</con2:comment>
                  <con2:id>_ActionId-7235988071129991800--6e9193b5.13e3b34e494.-7ff0</con2:id>
                </con2:resume>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="updateOredrCollectionStatusGateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct updateOrderCollectionStatusResponse">
        <con:comment>Constructing updateOrderCollectionStatusResponse from utilupdateOrderCollectionStatus Response.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="com" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If "acceptStatus" is coming from 'utilConfirmOrderPaymentResponse', then constructing final response
else raising the fault explicitly.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2359128528684647591--7c882c5e.149cd05379a.-7fc1</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/wmqi:companionMessage/wmqi:utilUpdateOrderCollectionStatusResp/com:acceptStatus)="SUCCESSFUL"</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5080115100900476550-2de44530.1403e5b383d.-7ffe</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/ConstructUpdateOrderCollectionStatusResponse"/>
                      <con2:param name="configXML">
                        <con2:path>$configXML</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:Error>
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5080115100900476550-2de44530.1403e5b383d.-7fff</con2:id>
                <con1:errCode>errorCode</con1:errCode>
                <con1:message>errorDescription.</con1:message>
              </con1:Error>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="GetConsignmentDetails_1 Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct GetConsignmentDetails_1 Response">
        <con:comment>Construct GetConsignmentDetails_1 response according to northbound</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2962908285105183071--120ded57.139af5826ea.-7feb</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                <con3:resource ref="ManageOrder_2_0/transformations/GetConsignmentDetails_1RequestSBToNB"/>
                <con3:param name="getconsignmentrequest">
                  <con3:path>$getconsignmentrequest/man:getConsignmentDetails_1</con3:path>
                </con3:param>
                <con3:param name="utilGetConsignmentDetailsResp">
                  <con3:path>$body/wmqi:companionMessage/wmqi:utilGetConsignmentDetailsResp</con3:path>
                </con3:param>
                <con3:param name="configXml">
                  <con3:path>$configXML</con3:path>
                </con3:param>
              </con3:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="GetDeliveryOptions_1 Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct GetDeliveryOptions_1 Response">
        <con:comment>Construct GetDeliveryOptions_1 Response according to northbound</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-403800558557879529--5167c2d1.1326d03769d.-7ff6</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/ConstructGetDeliveryOptions_1RS"/>
                <con2:param name="clickAndCollect">
                  <con2:path>data($configXML/clickAndCollect)</con2:path>
                </con2:param>
                <con2:param name="configXML">
                  <con2:path>$configXML</con2:path>
                </con2:param>
                <con2:param name="utilGetDeliveryOptionsResp">
                  <con2:path>$body/wmqi:companionMessage/wmqi:utilGetDeliveryOptionsResp</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-5717877515595668264--4685988c.1279332c8f0.-7ff6" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Generic Exception Handling">
        <con:comment>Handels both the backend faults and the ALSB faults.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="ns3" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="ns1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl prefix="man" namespace="http://soa.o2.co.uk/manageorderdata_2" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl prefix="psc" namespace="http://soa.o2.co.uk/pscommonpostpaydata_2" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl prefix="cor" namespace="http://soa.o2.co.uk/coredata_1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check if the fault is form the backend or from ALSB and retrieve the error map accordingly,
In case of the backend faults log the inbound and then fetch the errorMap.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3722388199481969321-40157b1d.12968158baf.-8000</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($fault/ctx:errorCode) = data($configXML/noOrderDetailsFault)
or
data($fault/ctx:errorCode) = data($configXML/noOrderListFault)
or
data($fault/ctx:errorCode) = data($configXML/getOrderDetails_2/noOrdersForOrderNumber)
or
data($fault/ctx:errorCode) = data($configXML/getOrderDetails_2/noOrdersForMSISDN)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:javaCallout varName="errorMap">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fd9</con2:id>
                  <con1:archive ref="Utility/errormaphandling/errormaphandling"/>
                  <con1:className>uk.co.o2.soa.sf.errormap.impl.FaultManagement</con1:className>
                  <con1:method>public static java.lang.String retreiveDestErrorMessage(org.apache.xmlbeans.XmlObject, java.lang.String)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($fault/ctx:errorCode)</con2:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/wmqi:companionMessage/cs:errorReport</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:javaCallout varName="errorMap">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6666960733634655815-2c406d77.1274c061c62.-7fef</con2:id>
                  <con1:archive ref="Utility/errormaphandling/errormaphandling"/>
                  <con1:className>uk.co.o2.soa.sf.errormap.impl.FaultManagement</con1:className>
                  <con1:method>public static java.lang.String retreiveDestErrorMessage(org.apache.xmlbeans.XmlObject, java.lang.String)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/wmqi:companionMessage/cs:errorReport/cs:errorCode)</con2:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:local-name($getArchiveOrderDetailsResponse/*[1])='Fault'
or
fn:local-name($getArchiveOrderListResponse/*[1])='Fault'
or
fn:local-name($utilGetOrderDetailsResponse/*[1])='Fault'
or
fn:local-name($utilGetOrderListResponse/*[1])='Fault'
or
fn:local-name($utilGetOrderDetails_2Response/*[1])='Fault'
or
fn:local-name($utilGetOrderList_2Response/*[1])='Fault'
or
fn:local-name($referenceDetailsResp/*[1])='Fault'
or
fn:local-name($body/*[1])='Fault'</con3:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:javaCallout varName="">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fdb</con2:id>
                  <con1:archive ref="Utility/o2framework/o2framework"/>
                  <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                  <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">if(fn:local-name($getArchiveOrderDetailsResponse/*[1])='Fault') then
	$getArchiveOrderDetailsResponse/*
else if(fn:local-name($getArchiveOrderListResponse/*[1])='Fault') then
	$getArchiveOrderListResponse/*
else if(fn:local-name($utilGetOrderDetailsResponse/*[1])='Fault') then
	$utilGetOrderDetailsResponse/*
else if(fn:local-name($utilGetOrderListResponse/*[1])='Fault') then
	$utilGetOrderListResponse/*
else if(fn:local-name($utilGetOrderDetails_2Response/*[1])='Fault') then
	$utilGetOrderDetails_2Response/*
else if(fn:local-name($utilGetOrderList_2Response/*[1])='Fault') then
	$utilGetOrderList_2Response/*
else if(fn:local-name($utilGetOrderListV4Resp/*[1])='Fault') then
	$utilGetOrderListV4Resp/*	
	else if(fn:local-name($referenceDetailsResp/*[1])='Fault') then
	$referenceDetailsResp/*		
else
	$body</con3:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
                <con1:javaCallout varName="errorMap">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fda</con2:id>
                  <con1:archive ref="Utility/errormaphandling/errormaphandling"/>
                  <con1:className>uk.co.o2.soa.sf.errormap.impl.FaultManagement</con1:className>
                  <con1:method>public static java.lang.String retreiveDestErrorMessage(org.apache.xmlbeans.XmlObject, java.lang.String)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">if(fn:local-name($getArchiveOrderDetailsResponse/*[1])='Fault') then
	data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)
	
else if(fn:local-name($getArchiveOrderListResponse/*[1])='Fault') then
	data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)
	
else if((fn:local-name($utilGetOrderListResponse/*[1])='Fault') and (data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode) != data($configXML/errorMap/ALSBvalidationErrorCode))) then
	data(data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode))
	
else if((fn:local-name($utilGetOrderDetailsResponse/*[1])='Fault') and (data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)!= data($configXML/errorMap/ALSBvalidationErrorCode))) then
	data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)
	
else if((fn:local-name($utilGetOrderList_2Response/*[1])='Fault') ) then
	data(data($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode))
	
else if((fn:local-name($utilGetOrderDetails_2Response/*[1])='Fault') ) then
	data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode)
else if((fn:local-name($utilGetOrderListV4Resp/*[1])='Fault') ) then
	data($utilGetOrderListV4Resp/soap-env:Fault/detail/*/xcore:SOAFaultCode)

	
	
else if((fn:local-name($body/*[1])='Fault') and (data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode)!= data($configXML/errorMap/ALSBvalidationErrorCode))) then
	data(data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode))
	
else if((data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)= data($configXML/errorMap/ALSBvalidationErrorCode)) or (data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/errorMap/ALSBvalidationErrorCode)) 
or (data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/errorMap/ALSBvalidationErrorCode))) then
	data($configXML/errorMap/destinationErrorCode)
	
	else if((fn:local-name($referenceDetailsResp/*[1])='Fault') ) then
	data($referenceDetailsResp/soap-env:Fault/detail/*/xcore:SOAFaultCode)
	
else ''</con3:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$utilGetOrderDetailsV5Resp/wmqi:companionMessage/cs:errorReport</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:javaCallout varName="errorMap">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c41</con2:id>
                  <con1:archive ref="Utility/errormaphandling/errormaphandling"/>
                  <con1:className>uk.co.o2.soa.sf.errormap.impl.FaultManagement</con1:className>
                  <con1:method>public static java.lang.String retreiveDestErrorMessage(org.apache.xmlbeans.XmlObject, java.lang.String)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($utilGetOrderDetailsV5Resp/wmqi:companionMessage/cs:errorReport/cs:errorCode)</con2:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$utilGetOrderListV4Resp/wmqi:companionMessage/cs:errorReport</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:javaCallout varName="errorMap">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c40</con2:id>
                  <con1:archive ref="Utility/errormaphandling/errormaphandling"/>
                  <con1:className>uk.co.o2.soa.sf.errormap.impl.FaultManagement</con1:className>
                  <con1:method>public static java.lang.String retreiveDestErrorMessage(org.apache.xmlbeans.XmlObject, java.lang.String)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($utilGetOrderListV4Resp/wmqi:companionMessage/cs:errorReport/cs:errorCode)</con2:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($utilGetOrderListV4Resp/wmqi:companionMessage/wmqi:utilGetOrderListV4Resp/cs:totalOrders)='1'
and
data($CukError)='true'</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:javaCallout varName="errorMap">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c3f</con2:id>
                  <con1:archive ref="Utility/errormaphandling/errormaphandling"/>
                  <con1:className>uk.co.o2.soa.sf.errormap.impl.FaultManagement</con1:className>
                  <con1:method>public static java.lang.String retreiveDestErrorMessage(org.apache.xmlbeans.XmlObject, java.lang.String)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($utilGetOrderDetailsV5Resp1/wmqi:companionMessage/cs:errorReport/cs:errorCode)</con2:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:local-name($GetOrderDetailsResp/*[1])="Fault"
or
fn:local-name($GetOrderListResp/*[1])="Fault"

or
fn:local-name($GetOrderDetailsResp1/*[1])="Fault"</con3:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:javaCallout varName="">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3652253983107135881-3a6eead3.15515c8d9a3.-7dd8</con3:id>
                  <con1:archive ref="Utility/o2framework/o2framework"/>
                  <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                  <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                  <con1:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">if(fn:local-name($GetOrderDetailsResp/*[1])='Fault') then
	$GetOrderDetailsResp/*
else if(fn:local-name($GetOrderListResp/*[1])='Fault') then
	$GetOrderListResp/*
else if(fn:local-name($GetOrderDetailsResp1/*[1])='Fault') then
	$GetOrderDetailsResp1/*
else
	$body</con3:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
                <con1:javaCallout varName="errorMap">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-982369420716417056--37856523.1550a433a66.-7fab</con3:id>
                  <con1:archive ref="Utility/errormaphandling/errormaphandling"/>
                  <con1:className>uk.co.o2.soa.sf.errormap.impl.FaultManagement</con1:className>
                  <con1:method>public static java.lang.String retreiveDestErrorMessage(org.apache.xmlbeans.XmlObject, java.lang.String)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">if(data($GetOrderDetailsResp/soap-env:Fault/detail/*/cor:SOAFaultCode)) then
(data($GetOrderDetailsResp/soap-env:Fault/detail/*/cor:SOAFaultCode)) 
else if

(data($GetOrderListResp/soap-env:Fault/detail/*/cor:SOAFaultCode) )then
data($GetOrderListResp/soap-env:Fault/detail/*/cor:SOAFaultCode)

else if
(data($GetOrderDetailsResp1/soap-env:Fault/detail/*/cor:SOAFaultCode))then
data($GetOrderDetailsResp1/soap-env:Fault/detail/*/cor:SOAFaultCode)
else ""</con3:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:ifThenElse>
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2962908285105183071--120ded57.139af5826ea.-7fe8</con2:id>
                <con1:case>
                  <con1:condition>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">(($operation = "getOrderList_2" 
or 
$operation = "getOrderDetails_2"
or
$operation = "submitUpgradeOrder_1" 
or 
$operation = "getDeliveryOptions_1" 
or 
$operation = "setConsignmentStateInOrder_1"
or
$operation = "confirmOrderPayment_1"
or
$operation = "getOrderDetails_3"
or
$operation = "getOrderList_3"
or
$operation = "updateOrderCollectionStatus"
or
$operation = "getConsignmentDetails_1"
or 
$operation = "confirmOrderTradeInCollection_1"
or
$operation ="getOrderSummary_1") and (data($fault/ctx:errorCode) = "BEA-382505"))</con3:xqueryText>
                  </con1:condition>
                  <con1:actions>
                    <con1:assign varName="errorMap">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2962908285105183071--120ded57.139af5826ea.-7fe7</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA['<errorMap>
<code>manageorder-36600-4501-V</code>
<description>Invalid request. Please check the input and resubmit.</description>
</errorMap>']]></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:actions>
                </con1:case>
                <con1:default>
                  <con1:javaCallout varName="errorMap">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c3e</con2:id>
                    <con1:archive ref="Utility/errormaphandling/errormaphandling"/>
                    <con1:className>uk.co.o2.soa.sf.errormap.impl.FaultManagement</con1:className>
                    <con1:method>public static java.lang.String retreiveDestErrorMessage(org.apache.xmlbeans.XmlObject, java.lang.String)</con1:method>
                    <con1:expr>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                    </con1:expr>
                    <con1:expr>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($fault/ctx:errorCode)</con2:xqueryText>
                    </con1:expr>
                  </con1:javaCallout>
                  <con1:ifThenElse>
                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6472636923528412134-78e1d5e3.1556cf78c45.-7e22</con4:id>
                    <con1:case>
                      <con1:condition>
                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">($operation = "confirmOrderTradeInCollection_1") and (data(fn-bea:inlinedXML($errorMap)/code)="manageorder-36600-3002-E")</con4:xqueryText>
                      </con1:condition>
                      <con1:actions>
                        <con1:assign varName="errorMap">
                          <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6472636923528412134-78e1d5e3.1556cf78c45.-7e21</con4:id>
                          <con1:expr>
                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config"><![CDATA['<errorMap>
<code>manageorder-36600-3999-E</code>
<description>Unknown/Uncaught error has occurred.</description>
</errorMap>']]></con4:xqueryText>
                          </con1:expr>
                        </con1:assign>
                      </con1:actions>
                    </con1:case>
                    <con1:default/>
                  </con1:ifThenElse>
                </con1:default>
              </con1:ifThenElse>
            </con1:default>
          </con1:ifThenElse>
          <con1:assign varName="errorMap1" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6852658306350579810--236a893.132ce4cfed6.-7ff4</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML($errorMap)</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check for Duplicate order number</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6852658306350579810--236a893.132ce4cfed6.-7ffa</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($errorMap1/code)="manageorder-36600-3097-E"</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fd6</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/ConstructGenericServiceFault"/>
                      <con2:param name="operationName">
                        <con2:path>$operation</con2:path>
                      </con2:param>
                      <con2:param name="faultTrace">
                        <con2:path>if($operation="submitUpgradeOrder_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)
	else 
   if(data($fault/ctx:errorCode))then
     if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
       fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
     else data($fault/ctx:errorCode)
	else ""  

else 

  if($operation="setConsignmentStateInOrder_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)
	else 
   if(data($fault/ctx:errorCode))then
     if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
       fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
     else data($fault/ctx:errorCode)
	else ""   	
  
else

if($operation="getConsignmentDetails_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)
	else 
   if(data($fault/ctx:errorCode))then
     if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
       fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
     else data($fault/ctx:errorCode)
	else ""   	
  
  	else

if($operation="confirmOrderTradeInCollection_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)
	else 
   if(data($fault/ctx:errorCode))then
     if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
       fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
     else data($fault/ctx:errorCode)
	else ""  
  
else

if($operation="confirmOrderPayment_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)				   
	else if(data($body/soap-env:Fault/detail/*/xcore:faultTrace)) then
		 data($body/soap-env:Fault/detail/*/xcore:faultTrace)
	else if($body/soap-env:Fault/detail/*/xcore:SOAFaultCode) then	
		 fn:concat(data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($body/soap-env:Fault/detail/*/xcore:faultDescription))	
	else if(data($fault/ctx:errorCode))then
		 if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
			fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
		 else 
			data($fault/ctx:errorCode)
	else ""   	
  
else

if(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace) and fn:contains(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace),'"&lt;')) then
	fn:substring-before(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace),'"&lt;')
else if(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace)) then	
	data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace)
else if(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace) and fn:contains(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace),'"&lt;')) then
	fn:substring-before(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace),'"&lt;')
else if(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace)) then
	data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace)
else if(data($body/soap-env:Fault/detail/*/xcore:faultTrace)) then
	data($body/soap-env:Fault/detail/*/xcore:faultTrace)	
else if(data($fault/ctx:errorCode) = data($configXML/errorMap/ALSBvalidationErrorCode)) then
	data($fault/ctx:details/con:ValidationFailureDetail/con:message)
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then
	fn:concat(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode) )then
	fn:concat(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then
	fn:concat(data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then
	fn:concat(data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then

fn:concat(data($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then
	fn:concat(data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($body/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then	fn:concat(data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($body/soap-env:Fault/detail/*/xcore:faultDescription))
else if($body/soap-env:Fault/detail/*/xcore:SOAFaultCode) then
fn:concat(data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($body/soap-env:Fault/detail/*/xcore:faultDescription))
else if(data($body/wmqi:companionMessage/*/cs:errorCode)) then
fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
else ""</con2:path>
                      </con2:param>
                      <con2:param name="errorMap">
                        <con2:path><![CDATA[if(
 (data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownSourceError)) and
 (
 ($operation = data($configXML/getOrderList_2/operationName) ) or 
($operation = data($configXML/getOrderDetails_2/operationName) ) or 
($operation = data($configXML/submitUpgradeOrder_1/operationName)) or 
($operation = data($configXML/getDeliveryOptions_1/operationName)) or
($operation = data($configXML/setConsignmentStateInOrder_1/operationName)) or
($operation = data($configXML/getConsignmentDetails_1/operationName)) or
($operation = data($configXML/confirmOrderTradeInCollection_1/operationName)) or
($operation = data($configXML/confirmOrderPayment_1/operationName))

)
) then
<errorMap>
<code>{ data($configXML/unknownDestinationError) }</code>
<description>{ data($configXML/unknownDestinationErrorDescription) }</description>
</errorMap>
else if(data($errorMap1/code)="manageorder-36600-3097-E")then
<errorMap>
<code>manageorder-36600-3097-E</code>                       
<description>Duplicate order number.Please check the input &#38;#38; resubmit.</description>
</errorMap>
else 
	fn-bea:inlinedXML($errorMap)]]></con2:path>
                      </con2:param>
                      <con2:param name="namespace">
                        <con2:path>"http://soa.o2.co.uk/manageorderdata_2"</con2:path>
                      </con2:param>
                      <con2:param name="transactionId">
                        <con2:path>if(data($header/xcore:SOATransactionID))then
data($header/xcore:SOATransactionID)
else if(data($incomingHeader/xcore:SOATransactionID))then
data($incomingHeader/xcore:SOATransactionID)
else ''</con2:path>
                      </con2:param>
                      <con2:param name="faultOriginator">
                        <con2:path>if($operation="submitUpgradeOrder_1")then
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else 
	 if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""

else	
 if($operation="setConsignmentStateInOrder_1")then
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""	 

else	
 if($operation="getOrderDetails_3")then  
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""	 
	 
else	
 if($operation="confirmOrderTradeInCollection_1")then  
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""	
else	
 if($operation="updateOrderCollectionStatus")then  
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""	
else	
 if($operation="getOrderList_3")then  
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""	 	  	 
else

if($operation="getConsignmentDetails_1")then
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""	 
	 
else

if($operation="confirmOrderPayment_1")then
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
	  else if(data($body/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
		  data($body/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
      else if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	      data($fault/ctx:location/ctx:node)
     else ""
	 
else

if(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderListV4Resp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderListV4Resp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($body/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($body/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($body/wmqi:companionMessage/cs:errorReport/cs:source))then
     data($body/wmqi:companionMessage/cs:errorReport/cs:source)	
else if(data($fault/ctx:details/ctx:ValidationFailureDetail/con:message)) then
	 data($fault/ctx:details/ctx:ValidationFailureDetail/con:message)
else if($fault/ctx:location/ctx:stage)then
	data($fault/ctx:location/ctx:stage)
else if($fault/ctx:location/ctx:node)then
	data($fault/ctx:location/ctx:node)
else ''</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:replace varName="body" contents-only="true">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c3d</con2:id>
                <con1:location>
                  <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                </con1:location>
                <con1:expr>
                  <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                    <con4:resource ref="ManageOrder_2_0/transformations/GenericErrorHandlerforRaiseError"/>
                    <con4:param name="faultTrace">
                      <con4:path>if($operation="submitUpgradeOrder_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)
	else 
   if(data($fault/ctx:errorCode))then
     if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
       fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
     else if( data($fault/ctx:reason)) then
	 fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:reason))
	 else data($fault/ctx:errorCode)
	else ""   
  
else 
  if($operation="setConsignmentStateInOrder_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)
	else 
   if(data($fault/ctx:errorCode))then
     if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
       fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
     else data($fault/ctx:errorCode)
	else ""   
  
else

if($operation="getConsignmentDetails_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)
	else 
   if(data($fault/ctx:errorCode))then
     if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
       fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
     else data($fault/ctx:errorCode)
	else ""   
	
		else

if($operation="confirmOrderTradeInCollection_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)
	else 
   if(data($fault/ctx:errorCode))then
     if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
       fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
     else data($fault/ctx:errorCode)
	else ""  
  
else

if($operation="confirmOrderPayment_1")then
  if(data($body/wmqi:companionMessage/*/cs:errorCode) ) then
		        if(data($body/wmqi:companionMessage/*/cs:errorText) ) then
		           fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
                else
				   data($body/wmqi:companionMessage/*/cs:errorCode)				   
	else if(data($body/soap-env:Fault/detail/*/xcore:faultTrace)) then
		 data($body/soap-env:Fault/detail/*/xcore:faultTrace)
	else if($body/soap-env:Fault/detail/*/xcore:SOAFaultCode) then	
		 fn:concat(data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($body/soap-env:Fault/detail/*/xcore:faultDescription))	
	else if(data($fault/ctx:errorCode))then
		 if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
			fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
		 else 
			data($fault/ctx:errorCode)
	else ""   	
  
else
  if($operation="getOrderSummary_1")then
  
  if(data($GetOrderDetailsResp/soap-env:Fault/detail/*/cor:faultTrace)) then
		        data($GetOrderDetailsResp/soap-env:Fault/detail/*/cor:faultTrace)
	else if (data($GetOrderListResp/soap-env:Fault/detail/*/cor:faultTrace)) then
		        data($GetOrderListResp/soap-env:Fault/detail/*/cor:faultTrace)			
        else if   (data($GetOrderDetailsResp1/soap-env:Fault/detail/*/cor:faultTrace)) then
		        data($GetOrderDetailsResp1/soap-env:Fault/detail/*/cor:faultTrace)     
	else  if(data($fault/ctx:errorCode))then
    
       fn:concat(data($fault/ctx:errorCode),":",data
	   ($fault/ctx:reason))
     else data($fault/ctx:errorCode)
	
  
else

if(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace) and fn:contains(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace),'"&lt;')) then
	fn:substring-before(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace),'"&lt;')
else if(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace)) then	
	data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultTrace)
else if(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace) and fn:contains(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace),'"&lt;')) then
	fn:substring-before(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace),'"&lt;')
else if(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace)) then
	data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultTrace)
else if(data($body/soap-env:Fault/detail/*/xcore:faultTrace)) then
	data($body/soap-env:Fault/detail/*/xcore:faultTrace)	
else if(data($fault/ctx:errorCode) = data($configXML/errorMap/ALSBvalidationErrorCode)) then
	data($fault/ctx:details/con:ValidationFailureDetail/con:message)
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then
	fn:concat(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode) )then
	fn:concat(data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($getArchiveOrderListResponse/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then
	fn:concat(data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then
	fn:concat(data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then

fn:concat(data($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then
	fn:concat(data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:faultDescription))
else if ((data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownErrorCode)) and ($body/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then	fn:concat(data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($body/soap-env:Fault/detail/*/xcore:faultDescription))

else if($body/soap-env:Fault/detail/*/xcore:SOAFaultCode) then
fn:concat(data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($body/soap-env:Fault/detail/*/xcore:faultDescription))
else if(data($utilGetOrderDetailsV5Resp/wmqi:companionMessage/*/cs:errorCode)) then
fn:concat(data($utilGetOrderDetailsV5Resp/wmqi:companionMessage/cs:errorReport/cs:errorCode),":",'',data($utilGetOrderDetailsV5Resp/wmqi:companionMessage/cs:errorReport/cs:errorText))
else if(data($utilGetOrderListV4Resp/wmqi:companionMessage/cs:errorReport/cs:errorCode)) then
fn:concat(data($utilGetOrderListV4Resp/wmqi:companionMessage/cs:errorReport/cs:errorCode),":",'',data($utilGetOrderListV4Resp/wmqi:companionMessage/cs:errorReport/cs:errorText))
else if (data($utilGetOrderDetailsV5Resp1/wmqi:companionMessage/cs:errorReport/cs:errorCode)) then
fn:concat(data($utilGetOrderDetailsV5Resp1/wmqi:companionMessage/cs:errorReport/cs:errorCode),":",'',data($utilGetOrderDetailsV5Resp1/wmqi:companionMessage/cs:errorReport/cs:errorText))
else if(data($body/wmqi:companionMessage/*/cs:errorCode)) then
fn:concat(data($body/wmqi:companionMessage/*/cs:errorCode),":",'',data($body/wmqi:companionMessage/*/cs:errorText))
else if(data($referenceDetailsResp/soap-env:Fault/detail/*/xcore:SOAFaultCode)) then	
		if(data($referenceDetailsResp/soap-env:Fault/detail/*/xcore:faultDescription))then
		fn:concat(data($referenceDetailsResp/soap-env:Fault/detail/*/xcore:SOAFaultCode),":",'',data($referenceDetailsResp/soap-env:Fault/detail/*/xcore:faultDescription))	
		else
		data($referenceDetailsResp/soap-env:Fault/detail/*/xcore:SOAFaultCode)
		
else  if(data($fault/ctx:errorCode))then
		 if(data($fault/ctx:details/con:ValidationFailureDetail/con:message))then
			fn:concat(data($fault/ctx:errorCode),":",data($fault/ctx:details/con:ValidationFailureDetail/con:message))
		 else if (data($fault/ctx:reason)and $operation="getOrderDetails_3") then
			data(fn:concat(data($fault/ctx:errorCode),':',data($fault/ctx:reason)))
				else
			        data($fault/ctx:errorCode)
         else""</con4:path>
                    </con4:param>
                    <con4:param name="errorMap">
                      <con4:path><![CDATA[if((data($errorMap1/code) = "manageorder-36600-3113-E") 
 and 
($operation = data($configXML/submitUpgradeOrder_1/operationName))) then
<errorMap>
<code>{ data($errorMap1/code) }</code>
<description>{ fn:concat(data($errorMap1/description),data($body/wmqi:companionMessage/cs:errorReport/cs:errorText)) }</description>
</errorMap>

else if(
(data(fn-bea:inlinedXML($errorMap)/code) = data($configXML/unknownSourceError)) and 
(
($operation = data($configXML/getOrderList_2/operationName) ) or 
($operation = data($configXML/getOrderDetails_2/operationName) ) or 
($operation = data($configXML/submitUpgradeOrder_1/operationName)) or 
($operation = data($configXML/getDeliveryOptions_1/operationName)) or
($operation = data($configXML/setConsignmentStateInOrder_1/operationName)) or
($operation = data($configXML/getConsignmentDetails_1/operationName)) or
($operation = data($configXML/confirmOrderTradeInCollection_1/operationName)) or
($operation = data($configXML/confirmOrderPayment_1/operationName)) 
)
) then
<errorMap>
<code>{ data($configXML/unknownDestinationError) }</code>
<description>{ data($configXML/unknownDestinationErrorDescription) }</description>
</errorMap>
else
	fn-bea:inlinedXML($errorMap)]]></con4:path>
                    </con4:param>
                    <con4:param name="namespace">
                      <con4:path>"http://soa.o2.co.uk/manageorderdata_2"</con4:path>
                    </con4:param>
                    <con4:param name="faultOriginator">
                      <con4:path>if($operation="submitUpgradeOrder_1")then
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""

else	
 if($operation="getOrderDetails_3")then  
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""	 
else	
 if($operation="updateOrderCollectionStatus")then  
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""	
else	
 if($operation="getOrderList_3")then  
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""		 

else
	
 if($operation="setConsignmentStateInOrder_1")then
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""

	 
	 	 
	 else

 if($operation="confirmOrderTradeInCollection_1")then
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""
	 
else

 if($operation="getConsignmentDetails_1")then
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
      else
	  if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	     data($fault/ctx:location/ctx:node)
     else ""

else

if($operation="confirmOrderPayment_1")then
      if(data($body/wmqi:companionMessage/cs:errorReport)) then
          data($configXML/BackenedApplicationName)
	  else if(data($body/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
		  data($body/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
      else if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	      data($fault/ctx:location/ctx:node)
     else ""
	 else
	 if($operation="getOrderSummary_1")then
      if(data($GetOrderDetailsResp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)) then
          data($GetOrderDetailsResp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
	  else if(data($GetOrderListResp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
		  data($GetOrderListResp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
		  else if(data($GetOrderDetailsResp1/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
		  data($GetOrderDetailsResp1/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
      else if($fault/ctx:location/ctx:stage)then
	      data($fault/ctx:location/ctx:stage)
     else if($fault/ctx:location/ctx:node)then
	      data($fault/ctx:location/ctx:node)
     else ""
else

if(data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($getArchiveOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderListResponse/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderList_2Response/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderListV4Resp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderListV4Resp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($utilGetOrderDetailsV5Resp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($utilGetOrderDetailsV5Resp/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)		
else if(data($body/soap-env:Fault/detail/*/xcore:SOAFaultOriginator))then
	data($body/soap-env:Fault/detail/*/xcore:SOAFaultOriginator)
else if(data($body/wmqi:companionMessage/cs:errorReport/cs:source))then
     data($body/wmqi:companionMessage/cs:errorReport/cs:source)	
else if(data($fault/ctx:details/ctx:ValidationFailureDetail/con:message)) then
	 data($fault/ctx:details/ctx:ValidationFailureDetail/con:message)
else if($fault/ctx:location/ctx:stage)then
	data($fault/ctx:location/ctx:stage)
else if($fault/ctx:location/ctx:node)then
	data($fault/ctx:location/ctx:node)
else ''</con4:path>
                    </con4:param>
                    <con4:param name="fault">
                      <con4:path>$fault</con4:path>
                    </con4:param>
                    <con4:param name="transactionId">
                      <con4:path>if(data($header/xcore:SOATransactionID))then
data($header/xcore:SOATransactionID)
else if(data($incomingHeader/xcore:SOATransactionID))then
data($incomingHeader/xcore:SOATransactionID)
else ''</con4:path>
                    </con4:param>
                    <con4:param name="operationName">
                      <con4:path>$operation</con4:path>
                    </con4:param>
                  </con4:xqueryTransform>
                </con1:expr>
              </con1:replace>
            </con1:default>
          </con1:ifThenElse>
          <con1:javaCallout varName="header" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fd8</con2:id>
            <con1:archive ref="Utility/o2framework/o2framework"/>
            <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
            <con1:method>public static org.apache.xmlbeans.XmlObject logFault(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, java.lang.String)</con1:method>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
            </con1:expr>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
            </con1:expr>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/soap-env:Fault/detail/*/xcore:SOAFaultCode)</con2:xqueryText>
            </con1:expr>
          </con1:javaCallout>
          <con1:reply isError="true" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
            <con1:id>_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fd7</con1:id>
          </con1:reply>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="GetOrderDetails_2 Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate GetOrderDetails_2 request">
        <con:comment>Validating the request of getOrderDetails_2 against its northbound schema.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7fb6</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:getOrderDetails_2</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:getOrderDetails_2</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Call Technical Service UtilGetOrderDetails_1_0.utilGetOrderDetails_2" errorHandler="_onErrorHandler-9206357943963450379--4705864e.12efb0d0494.-7fa0">
        <con:comment>Constructs UtilGetOrderDetails_1_0.utilGetOrderDetails_2 request and 
invokes UtilGetOrderDetails_1_0.utilGetOrderDetails_2 operation 
and logs the outbound and inbound respectively.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7fb5</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/GetOrderDetails_2RQToUtilGetOrderDetails_2RQ"/>
                <con2:param name="getOrderDetails_2">
                  <con2:path>$body/man:getOrderDetails_2</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
          <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7fb4</con2:id>
            <con1:service xsi:type="ref:ProxyRef" ref="UtilGetOrderDetails_1_0/proxyservices/UtilGetOrderDetails_1_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con1:operation>utilGetOrderDetails_2</con1:operation>
            <con1:request>
              <con1:body wrapped="true">$body</con1:body>
              <con1:header>$header</con1:header>
            </con1:request>
            <con1:response>
              <con1:body wrapped="true">utilGetOrderDetails_2Response</con1:body>
              <con1:header>header</con1:header>
            </con1:response>
            <con1:requestTransform>
              <con1:javaCallout varName="">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ffe</con2:id>
                <con1:archive ref="Utility/o2framework/o2framework"/>
                <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                </con1:expr>
              </con1:javaCallout>
            </con1:requestTransform>
            <con1:responseTransform>
              <con1:javaCallout varName="">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ffd</con2:id>
                <con1:archive ref="Utility/o2framework/o2framework"/>
                <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$utilGetOrderDetails_2Response</con2:xqueryText>
                </con1:expr>
              </con1:javaCallout>
            </con1:responseTransform>
          </con1:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Call Adapter Service OrderEnquiry_1_0.getArchiveOrderDetails1">
        <con:comment>Constructs OrderEnquiry_1_0.getArchiveOrderDetails
request and invokes OrderEnquiry_1_0.getArchiveOrderDetails
operation and logs the outbound and inbound respectively.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If isArchiveOrderRequired flag is present in the request and the value is true and no orders are retrieved from the UtilGetOrderDetails service or fault thrown by 
UtilGetOrderDetails with fault code 'utilgetorderdetails-9281-3000-E' or 'utilgetorderdetails-9281-3001-E', then invoke OrderEnquiry_1_0 service.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2081599261382681008--79eca1b1.13397666c14.-7fe0</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($incomingRequest/man:getOrderDetails_2/man:isArchiveOrderRequired) = data($configXML/TrueValue)
and
((data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForOrderNumber)) or (data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForMSISDN)))</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ff7</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/ConstructGetArchiveOrderDetailsRQ"/>
                      <con2:param name="msisdn">
                        <con2:path>if ($incomingRequest/man:getOrderDetails_2/man:msisdn)
then data($incomingRequest/man:getOrderDetails_2/man:msisdn) 
else ''</con2:path>
                      </con2:param>
                      <con2:param name="orderNumber">
                        <con2:path>if ($incomingRequest/man:getOrderDetails_2/man:orderNumber)
then data($incomingRequest/man:getOrderDetails_2/man:orderNumber)
else ''</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ff6</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="ManageOrder_2_0/businessservices/OrderEnquiry_1_0_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getArchiveOrderDetails</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$header</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">getArchiveOrderDetailsResponse</con1:body>
                    <con1:header>header</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:javaCallout varName="">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ff5</con2:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                      </con1:expr>
                    </con1:javaCallout>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:javaCallout varName="">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ff4</con2:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$getArchiveOrderDetailsResponse</con2:xqueryText>
                      </con1:expr>
                    </con1:javaCallout>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="GetOrderList_2 Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate GetOrderList_2 Request">
        <con:comment>Validating the request of getOrderList_2 against its northbound schema.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7fcb</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:getOrderList_2</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:getOrderList_2</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Custom Validation">
        <con:comment>Validates the request according to the business requirement.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If isArchiveOrderRequired flag is present in the request and its set to true and MSISDN is not present in the request, then raise an error.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7fca</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/man:getOrderList_2/man:isArchiveOrderRequired) = data($configXML/TrueValue)
and
fn:string-length(data($body/man:getOrderList_2/man:msisdn)) = 0</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:Error>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7365573942187297934--2018f741.12edd880a6a.-7ffa</con2:id>
                  <con1:errCode>manageorder-36600-4001-V</con1:errCode>
                  <con1:message>Archive Order retrieval is supported only for a MSISDN.</con1:message>
                </con1:Error>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Call Technical Service UtilGetOrderList_1_0.utilGetOrderList_2">
        <con:comment>Constructs UtilGetOrderList_1_0.utilGetOrderList_2 request and 
invokes UtilGetOrderList_1_0.utilGetOrderList_2 operation 
and logs the outbound and inbound respectively.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7fc8</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/GetOrderList_2RQToUtilGetOrderList_2RQ"/>
                <con2:param name="getOrderList_2">
                  <con2:path>$body/man:getOrderList_2</con2:path>
                </con2:param>
                <con2:param name="portalDomain">
                  <con2:path>data($configXML/portalDomain)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
          <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7fc7</con2:id>
            <con1:service xsi:type="ref:ProxyRef" ref="UtilGetOrderList_1_0/proxyservices/UtilGetOrderList_1_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con1:operation>utilGetOrderList_2</con1:operation>
            <con1:request>
              <con1:body wrapped="true">$body</con1:body>
              <con1:header>$header</con1:header>
            </con1:request>
            <con1:response>
              <con1:body wrapped="true">utilGetOrderList_2Response</con1:body>
              <con1:header>header</con1:header>
            </con1:response>
            <con1:requestTransform>
              <con1:javaCallout varName="">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7365573942187297934--2018f741.12edd880a6a.-7ff4</con2:id>
                <con1:archive ref="Utility/o2framework/o2framework"/>
                <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                </con1:expr>
              </con1:javaCallout>
            </con1:requestTransform>
            <con1:responseTransform>
              <con1:javaCallout varName="">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7365573942187297934--2018f741.12edd880a6a.-7ff3</con2:id>
                <con1:archive ref="Utility/o2framework/o2framework"/>
                <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                </con1:expr>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$utilGetOrderList_2Response</con2:xqueryText>
                </con1:expr>
              </con1:javaCallout>
            </con1:responseTransform>
          </con1:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Call Adapter Service OrderEnquiry_1_0.getArchiveOrderList" errorHandler="_onErrorHandler-2081599261382681008--79eca1b1.13397666c14.-7fe8">
        <con:comment>Constructs OrderEnquiry_1_0.getArchiveOrderList
request and invokes OrderEnquiry_1_0.getArchiveOrderList
operation and logs the outbound and inbound respectively.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderlistdata_1" prefix="gol" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If number of orders retrieved from UtilGetOrderList_1_0 service is less than the requested number of orders 
and isArchiveOrderRequired flag is set to true, then call OrderEnquiry_1_0.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2081599261382681008--79eca1b1.13397666c14.-7ff0</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">xs:integer(data($utilGetOrderList_2Response/gol:utilGetOrderList_2Response/gol:ordersReturned)) &lt; xs:integer(data($incomingRequest/man:getOrderList_2/man:ordersSelectionCriteria/man:numOrdersRequired))
and
data($incomingRequest/man:getOrderList_2/man:isArchiveOrderRequired) = data($configXML/TrueValue)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7fff</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/GetOrderListRQToGetArchiveOrderListRQ"/>
                      <con2:param name="msisdn">
                        <con2:path>data($incomingRequest/man:getOrderList_2/man:msisdn)</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7ffe</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="ManageOrder_2_0/businessservices/OrderEnquiry_1_0_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getArchiveOrderList</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$header</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">getArchiveOrderListResponse</con1:body>
                    <con1:header>header</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:javaCallout varName="">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7ffd</con2:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                      </con1:expr>
                    </con1:javaCallout>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:javaCallout varName="">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7ffc</con2:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$getArchiveOrderListResponse</con2:xqueryText>
                      </con1:expr>
                    </con1:javaCallout>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="GetOrderDetails Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate GetOrderDetails Request">
        <con:comment>Validates the request against the Northbound xsd.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7ff5</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:getOrderDetails</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:getOrderDetails</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Call Technical Service UtilGetOrderDetails" errorHandler="_onErrorHandler-79239375595321023-29921892.12861827c5c.-7fea">
        <con:comment>ConstructsUtilGetOrderDetails_1_0.utilGetOrderDetails request and 
invokes UtilGetOrderDetails_1_0.utilGetOrderDetails operation 
and logs the outbound and inbound respectively.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7ff2</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/GetOrderDetailsRQToUtilGetOrderDetailsRQ"/>
                <con2:param name="getOrderDetails">
                  <con2:path>$body/man:getOrderDetails</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
          <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-79239375595321023-29921892.12861827c5c.-7ffa</con2:id>
            <con1:service xsi:type="ref:ProxyRef" ref="UtilGetOrderDetails_1_0/proxyservices/UtilGetOrderDetails_1_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con1:operation>utilGetOrderDetails</con1:operation>
            <con1:request>
              <con1:body wrapped="true">$body</con1:body>
              <con1:header>$header</con1:header>
            </con1:request>
            <con1:response>
              <con1:body wrapped="true">utilGetOrderDetailsResponse</con1:body>
              <con1:header>header</con1:header>
            </con1:response>
            <con1:requestTransform>
              <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fe9</con3:id>
                <con3:archive ref="Utility/o2framework/o2framework"/>
                <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                <con3:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                </con3:expr>
              </con3:javaCallout>
            </con1:requestTransform>
            <con1:responseTransform>
              <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7ff0</con3:id>
                <con3:archive ref="Utility/o2framework/o2framework"/>
                <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                <con3:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                </con3:expr>
                <con3:expr>
                  <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$utilGetOrderDetailsResponse</con4:xqueryText>
                </con3:expr>
              </con3:javaCallout>
            </con1:responseTransform>
          </con1:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Call Adapter Service OrderEnquiry">
        <con:comment>Constructs OrderEnquiry_1_0.getArchiveOrderDetails
request and invokes OrderEnquiry_1_0.getArchiveOrderDetails
operation and logs the outbound and inbound respectively</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderdetailsdata_1" prefix="god" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Call the OrderEnquiry Adapter service if consuming 
application has set the flag and no orders returned by 
UtilGetOrderDetails Service or fault thrown by 
UtilGetOrderDetails with fault code 'CUK_6001_W'.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-79239375595321023-29921892.12861827c5c.-7ff1</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($incomingRequest/man:getOrderDetails/man:isArchiveOrderRequired) = data($configXML/TrueValue)
and
data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/cukNoDetails)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-79239375595321023-29921892.12861827c5c.-7fef</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/ConstructGetArchiveOrderDetailsRQ"/>
                      <con2:param name="msisdn">
                        <con2:path>if($incomingRequest/man:getOrderDetails/man:msisdn) then
	data($incomingRequest/man:getOrderDetails/man:msisdn)
else ''</con2:path>
                      </con2:param>
                      <con2:param name="orderNumber">
                        <con2:path>if($incomingRequest/man:getOrderDetails/man:orderNumber) then
	data($incomingRequest/man:getOrderDetails/man:orderNumber)
else ''</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-79239375595321023-29921892.12861827c5c.-7ff0</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="ManageOrder_2_0/businessservices/OrderEnquiry_1_0_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getArchiveOrderDetails</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$header</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">getArchiveOrderDetailsResponse</con1:body>
                    <con1:header>header</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c47</con3:id>
                      <con3:archive ref="Utility/o2framework/o2framework"/>
                      <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                      <con3:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                      </con3:expr>
                    </con3:javaCallout>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c46</con3:id>
                      <con3:archive ref="Utility/o2framework/o2framework"/>
                      <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                      <con3:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                      </con3:expr>
                      <con3:expr>
                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$getArchiveOrderDetailsResponse</con4:xqueryText>
                      </con3:expr>
                    </con3:javaCallout>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="SubmitUpgradeOrder_1 Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct SubmitUpgradeOrder_1 Response">
        <con:comment>Construct northbound response for SubmitUpgradeOrder_1</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-403800558557879529--5167c2d1.1326d03769d.-7ffb</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/ConstructSubmitUpgradeOrder_1RS"/>
                <con2:param name="successStatusCode">
                  <con2:path>$configXML/successStatusCode</con2:path>
                </con2:param>
                <con2:param name="utilSubmitUpgradeOrderResp">
                  <con2:path>$body/wmqi:companionMessage/wmqi:utilSubmitUpgradeOrderResp</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="GetConsignmentDetails_1 Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate GetConsignmentDetails_1 Request ">
        <con:comment>Validate GetConsignmentDetails_1 Request against the Northbound xsd</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7610802886273542248-3e91fc36.1399f868873.-7fff</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:getConsignmentDetails_1</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:getConsignmentDetails_1</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Saving  the incoming request">
        <con:comment>Saving  the incoming request.</con:comment>
        <con:context/>
        <con:actions>
          <con2:assign varName="getconsignmentrequest">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-1107658138246821198--26b2cb52.15515732991.-754e</con3:id>
            <con2:expr>
              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
            </con2:expr>
          </con2:assign>
        </con:actions>
      </con:stage>
      <con:stage name="Check For OrderNumer,ConsignmentNumber,StoreNumber">
        <con:comment>Check For orderNumer,ConsignmentNumber,StoreNumber.
If none of them is passed  in the request,error is thrown and  
controll is transfered to errohandler.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check For OrderNumer,ConsignmentNumber,StoreNumber.
If none of them is passed  in the request,error is thrown and  
controll is transfered to errohandler.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2962908285105183071--120ded57.139af5826ea.-7fea</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(
fn:not(fn:exists($body/man:getConsignmentDetails_1/man:orderNumber))
and
fn:not(fn:exists($body/man:getConsignmentDetails_1/man:consignmentNumber))
and
fn:not(fn:exists($body/man:getConsignmentDetails_1/man:storeNumber))
)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:Error>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2962908285105183071--120ded57.139af5826ea.-7fe9</con2:id>
                  <con1:errCode>manageorder-36600-3056-E</con1:errCode>
                  <con1:message>The request does should contain one of order number, consignment number or store number in the input</con1:message>
                </con1:Error>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Construct GetConsignmentDetails_1 Request">
        <con:comment>Construct GetConsignmentDetails_1 request to invoke CUK backend</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2962908285105183071--120ded57.139af5826ea.-7ff6</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/GetConsignmentDetails_1RequestNBToSB"/>
                <con2:param name="getConsignmentDetails_1">
                  <con2:path>$body/man:getConsignmentDetails_1</con2:path>
                </con2:param>
                <con2:param name="SOATransactionId">
                  <con2:path>if(data($header/xcore:SOATransactionID)) then
		    data($header/xcore:SOATransactionID)
		   else ""</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="GetOrderList_2 Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct GetOrderList_2 Response">
        <con:comment>Construct the northbound response for getOrderList_2 operation.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderlistdata_1" prefix="gol" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/archiveorderenquirydata_1" prefix="aoe" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/orderenquirydata_1" prefix="oed" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7fbc</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/ConstructGetOrderList_2RS"/>
                <con2:param name="balanceOrdersCount">
                  <con2:path>if($getArchiveOrderListResponse/oed:getArchiveOrderListResponse) then
	xs:integer(data($incomingRequest/man:getOrderList_2/man:ordersSelectionCriteria/man:numOrdersRequired)- 	data(fn:count($utilGetOrderList_2Response/gol:utilGetOrderList_2Response/gol:order)))
else
	xs:integer(data($configXML/ZeroValue))</con2:path>
                </con2:param>
                <con2:param name="getArchiveOrderListResponse">
                  <con2:path>if ($getArchiveOrderListResponse/oed:getArchiveOrderListResponse) then
	$getArchiveOrderListResponse/oed:getArchiveOrderListResponse
else
	&lt;oed:getArchiveOrderListResponse/></con2:path>
                </con2:param>
                <con2:param name="configXml">
                  <con2:path>$configXML</con2:path>
                </con2:param>
                <con2:param name="utilGetOrderList_2Response">
                  <con2:path>$utilGetOrderList_2Response/gol:utilGetOrderList_2Response</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="ConfirmOrderPayment_1 Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct ConfirmOrderPayment_1Response">
        <con:comment>Constructing ConfirmOrderPayment_1Response from utilConfirmOrderPayment Response.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="com" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If "acceptStatus" is coming from 'utilConfirmOrderPaymentResponse', then constructing final response
else raising the fault explicitly.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5080115100900476550-2de44530.1403e5b383d.-7ff5</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/wmqi:companionMessage/wmqi:utilConfirmOrderPaymentResp/com:acceptStatus</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c45</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/ConstructConfirmOrderPayment_1Response"/>
                      <con2:param name="configXML">
                        <con2:path>$configXML</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:Error>
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c44</con2:id>
                <con1:errCode>errorCode</con1:errCode>
                <con1:message>errorDescription.</con1:message>
              </con1:Error>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="GetDeliveryOptions_1 Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate  GetDeliveryOptions_1 Request ">
        <con:comment>Validate  GetDeliveryOptions_1 Request against the Northbound xsd</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-403800558557879529--5167c2d1.1326d03769d.-7ffa</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:getDeliveryOptions_1</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:getDeliveryOptions_1</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Construct GetDeliveryOptions_1 Request">
        <con:comment>Construct GetDeliveryOptions_1 Request to invoke CUK backend</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-403800558557879529--5167c2d1.1326d03769d.-7ff8</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/ConstructGetDeliveryOptions_1RQ"/>
                <con2:param name="getDeliveryOptions_1">
                  <con2:path>$body/man:getDeliveryOptions_1</con2:path>
                </con2:param>
                <con2:param name="defaultTime">
                  <con2:path>$configXML/defaultTime</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="ConfirmOrderPayment_1 Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate ConfirmOrderPayment_1 Request ">
        <con:comment>Validating ConfirmOrderPayment_1 Request against NorthBoundInterfaces/manageorderdata_2_0.xsd</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5080115100900476550-2de44530.1403e5b383d.-7ff7</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:confirmOrderPayment_1</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:confirmOrderPayment_1</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Construct UtilConfirmOrderPayment Request">
        <con:comment>Constructing  the request to utilConfirmOrderPayment( ) Service from the ManageOrder:ConfirmOrderPayment_1 Request.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5080115100900476550-2de44530.1403e5b383d.-7ff6</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/ConfirmOrderPayment_1RQToUtilConfirmOrderPaymentRQ"/>
                <con2:param name="confirmOrderPayment_1">
                  <con2:path>$body/man:confirmOrderPayment_1</con2:path>
                </con2:param>
                <con2:param name="header">
                  <con2:path>$header</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline name="_onErrorHandler-2081599261382681008--79eca1b1.13397666c14.-7fe8" type="error" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Handles GetArchiveOrderDetails Fault">
        <con:comment>Handles the fault from GetArchiveOrderDetails when 
UtilGetOrderList returns non-zero orders.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderlistdata_1" prefix="gol" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Resume the flow if GetArchiveOrderDetails return fault 
however UtilGetOrderList contains non-zero order element.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2081599261382681008--79eca1b1.13397666c14.-7feb</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:local-name($getArchiveOrderListResponse/*[1])='Fault'
and
fn:count($utilGetOrderList_2Response/gol:utilGetOrderList_2Response/gol:order) != data($configXML/ZeroValue)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:javaCallout varName="">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7ff5</con2:id>
                  <con1:archive ref="Utility/o2framework/o2framework"/>
                  <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                  <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$getArchiveOrderListResponse</con2:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
                <con2:resume xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                  <con2:comment>Resume the flow if GetArchiveOrderDetails return fault 
however UtilGetOrderList contains non-zero order element.</con2:comment>
                  <con2:id>_ActionId-5798776197794597401-1b389918.12ee72ae6a7.-7ff6</con2:id>
                </con2:resume>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con1:pipeline type="error" name="_onErrorHandler-4766323174444255149-590132d7.152d44cf4eb.-757e">
      <con1:stage name="StageErrorHandler">
        <con1:comment>StageErrorHandler to handle errors from Reference Details and continue with the flow.</con1:comment>
        <con1:context>
          <con:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore"/>
        </con1:context>
        <con1:actions>
          <con2:ifThenElse>
            <con:comment>Condition to check if ReferenceDetailsService is returning "REFCOM001" ,if it returns we will skip the stage and Construct the final response.</con:comment>
            <con:id>_ActionId-4766323174444255149-590132d7.152d44cf4eb.-7550</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>fn:contains(data($referenceDetailsResp/soap-env:Fault/detail/*/xcore:SOAFaultCode),"REF-COM-001")</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:javaCallout varName="">
                  <con:id>_ActionId-4766323174444255149-590132d7.152d44cf4eb.-7449</con:id>
                  <con2:archive ref="Utility/o2framework/o2framework"/>
                  <con2:className>uk.co.o2.soa.sf.logging.impl.Logging</con2:className>
                  <con2:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                  <con2:expr>
                    <con:xqueryText>$inbound</con:xqueryText>
                  </con2:expr>
                  <con2:expr>
                    <con:xqueryText>$outbound</con:xqueryText>
                  </con2:expr>
                  <con2:expr>
                    <con:xqueryText>$header</con:xqueryText>
                  </con2:expr>
                  <con2:expr>
                    <con:xqueryText>$referenceDetailsResp</con:xqueryText>
                  </con2:expr>
                </con2:javaCallout>
                <con:resume>
                  <con:comment>If ReferenceDetailsService returns "REF-COM-001" then resuming the flow.</con:comment>
                  <con:id>_ActionId-4766323174444255149-590132d7.152d44cf4eb.-7521</con:id>
                </con:resume>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con:pipeline type="response" name="GetOrderDetails_2 Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct GetOrderDetails_2 Response">
        <con:comment>Construct the northbound response for getOrderDetails_2 operation 
if non-zero orders being returned by UtilGetOrderDetails_1_0.utilGetOrderDetails_2 or OrderEnquiry_1_0.getArchiveOrderDetails, 
otherwise raise error.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/orderenquirydata_1" prefix="oed" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderdetailsdata_1" prefix="god" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/archiveorderenquirydata_1" prefix="aoe" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check if the orders are present then construct the final response
else throw 'utilgetorderdetails-9281-3000-E' or 'utilgetorderdetails-9281-3001-E' error.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7fa9</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($incomingRequest/man:getOrderDetails_2/man:isArchiveOrderRequired) = data($configXML/TrueValue)
and
((data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForOrderNumber)) or (data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForMSISDN)))</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:ifThenElse>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ff2</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($getArchiveOrderDetailsResponse/oed:getArchiveOrderDetailsResponse/oed:orderCount) = data($configXML/ZeroValue)
and
data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForOrderNumber)</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:Error>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ff0</con2:id>
                        <con1:errCode>utilgetorderdetails-9281-3000-E</con1:errCode>
                        <con1:message>No orders found for specified Order Number.</con1:message>
                      </con1:Error>
                    </con1:actions>
                  </con1:case>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($getArchiveOrderDetailsResponse/oed:getArchiveOrderDetailsResponse/oed:orderCount) = data($configXML/ZeroValue)
and
data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForMSISDN)</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:Error>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7fef</con2:id>
                        <con1:errCode>utilgetorderdetails-9281-3001-E</con1:errCode>
                        <con1:message>No orders found for specified MSISDN.</con1:message>
                      </con1:Error>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7fee</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                          <con2:resource ref="ManageOrder_2_0/transformations/GetArchiveOrderDetailsRSToGetOrderDetails_2RS"/>
                          <con2:param name="configData">
                            <con2:path>$configXML</con2:path>
                          </con2:param>
                          <con2:param name="getArchiveOrderDetailsResponse">
                            <con2:path>$getArchiveOrderDetailsResponse/oed:getArchiveOrderDetailsResponse</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                  </con1:default>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:ifThenElse>
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ff1</con2:id>
                <con1:case>
                  <con1:condition>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForOrderNumber)</con2:xqueryText>
                  </con1:condition>
                  <con1:actions>
                    <con1:Error>
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7feb</con2:id>
                      <con1:errCode>utilgetorderdetails-9281-3000-E</con1:errCode>
                      <con1:message>No orders found for specified Order Number.</con1:message>
                    </con1:Error>
                  </con1:actions>
                </con1:case>
                <con1:case>
                  <con1:condition>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForMSISDN)</con2:xqueryText>
                  </con1:condition>
                  <con1:actions>
                    <con1:Error>
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7fea</con2:id>
                      <con1:errCode>utilgetorderdetails-9281-3001-E</con1:errCode>
                      <con1:message>No orders found for specified MSISDN.</con1:message>
                    </con1:Error>
                  </con1:actions>
                </con1:case>
                <con1:default>
                  <con1:replace varName="body" contents-only="true">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7fe9</con2:id>
                    <con1:location>
                      <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                    </con1:location>
                    <con1:expr>
                      <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:resource ref="ManageOrder_2_0/transformations/UtilGetOrderDetails_2RSToGetOrderDetails_2RS"/>
                        <con2:param name="configData">
                          <con2:path>$configXML</con2:path>
                        </con2:param>
                        <con2:param name="utilGetOrderDetails_2Response">
                          <con2:path>$utilGetOrderDetails_2Response/god:utilGetOrderDetails_2Response</con2:path>
                        </con2:param>
                      </con2:xqueryTransform>
                    </con1:expr>
                  </con1:replace>
                </con1:default>
              </con1:ifThenElse>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="GetOrderList Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct GetOrderList Response">
        <con:comment>Construct the northbound response for getOrderList operation
if non-zero orders being returned by UtilGetOrderList or 
GetArchiveOrderDetais
	else raise error</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/orderenquirydata_1" prefix="oed" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderlistdata_1" prefix="gol" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check if the orders are present then construct the final response
else throw manageorder-36600-3000-E error.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3508874997276180786--30c260ca.12867e3b122.-7ff8</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($incomingRequest/man:getOrderList/man:isArchiveOrderRequired) = data($configXML/TrueValue)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:ifThenElse>
                  <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check if the orders are present then construct the final response
else throw manageorder-36600-3000-E error.</con2:comment>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fdf</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:count($getArchiveOrderListResponse/oed:getArchiveOrderListResponse/oed:orders) = data($configXML/ZeroValue)
and
fn:count($utilGetOrderListResponse/gol:utilGetOrderListResponse/gol:order) = data($configXML/ZeroValue)</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:Error>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fde</con2:id>
                        <con1:errCode>manageorder-36600-3000-E</con1:errCode>
                        <con1:message>No orders found for the given order identifier.</con1:message>
                      </con1:Error>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5875112021626571551-7e455e97.1285d42cc63.-7fda</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                          <con2:resource ref="ManageOrder_2_0/transformations/ConstructGetOrderListRS"/>
                          <con2:param name="balanceOrdersCount">
                            <con2:path>xs:integer(data($incomingRequest/man:getOrderList/man:ordersSelectionCriteria/man:numOrdersRequired)- data(fn:count($utilGetOrderListResponse/gol:utilGetOrderListResponse/gol:order)))</con2:path>
                          </con2:param>
                          <con2:param name="getArchiveOrderListResponse">
                            <con2:path>if($getArchiveOrderListResponse/oed:getArchiveOrderListResponse) then
	$getArchiveOrderListResponse/oed:getArchiveOrderListResponse
else
	&lt;oed:getArchiveOrderListResponse/></con2:path>
                          </con2:param>
                          <con2:param name="configXml">
                            <con2:path>$configXML</con2:path>
                          </con2:param>
                          <con2:param name="utilGetOrderListResponse">
                            <con2:path>$utilGetOrderListResponse/gol:utilGetOrderListResponse</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                  </con1:default>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:ifThenElse>
                <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check if the orders are present then construct the final response
else throw manageorder-36600-3000-E error.</con2:comment>
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3508874997276180786--30c260ca.12867e3b122.-7ff4</con2:id>
                <con1:case>
                  <con1:condition>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:count($utilGetOrderListResponse/gol:utilGetOrderListResponse/gol:order) != data($configXML/ZeroValue)</con2:xqueryText>
                  </con1:condition>
                  <con1:actions>
                    <con1:replace contents-only="true" varName="body">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fdd</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                          <con2:resource ref="ManageOrder_2_0/transformations/ConstructGetOrderListRS"/>
                          <con2:param name="balanceOrdersCount">
                            <con2:path>data($configXML/ZeroValue)</con2:path>
                          </con2:param>
                          <con2:param name="getArchiveOrderListResponse">
                            <con2:path>&lt;oed:getArchiveOrderListResponse/></con2:path>
                          </con2:param>
                          <con2:param name="configXml">
                            <con2:path>$configXML</con2:path>
                          </con2:param>
                          <con2:param name="utilGetOrderListResponse">
                            <con2:path>$utilGetOrderListResponse/gol:utilGetOrderListResponse</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                  </con1:actions>
                </con1:case>
                <con1:default>
                  <con1:Error>
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c64</con2:id>
                    <con1:errCode>manageorder-36600-3000-E</con1:errCode>
                    <con1:message>No orders found for the given order identifier.</con1:message>
                  </con1:Error>
                </con1:default>
              </con1:ifThenElse>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-5875112021626571551-7e455e97.1285d42cc63.-7fe5" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Handles GetArchiveOrderDetails Fault">
        <con:comment>Handles the fault from GetArchiveOrderDetails when 
UtilGetOrderList returns non-zero orders</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderlistdata_1" prefix="gol" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Resume the flow if GetArchiveOrderDetails return fault 
however UtilGetOrderList contains non-zero order element.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5875112021626571551-7e455e97.1285d42cc63.-7fe4</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:local-name($getArchiveOrderListResponse/*[1])='Fault'
and
fn:count($utilGetOrderListResponse/gol:utilGetOrderListResponse/gol:order) != data($configXML/ZeroValue)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fe0</con3:id>
                  <con3:archive ref="Utility/o2framework/o2framework"/>
                  <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                  <con3:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                  <con3:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                  </con3:expr>
                  <con3:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                  </con3:expr>
                  <con3:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                  </con3:expr>
                  <con3:expr>
                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$getArchiveOrderListResponse</con4:xqueryText>
                  </con3:expr>
                </con3:javaCallout>
                <con2:resume xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                  <con2:comment>Resume the flow if GetArchiveOrderDetails return fault 
however UtilGetOrderList contains non-zero order element.</con2:comment>
                  <con2:id>_ActionId-5875112021626571551-7e455e97.1285d42cc63.-7fe3</con2:id>
                </con2:resume>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="SetConsignmentStateInOrder_1 Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct SetConsignmentStateInOrder_1 Response">
        <con:comment>Construct SetConsignmentStateInOrder_1 response according to northbound</con:comment>
        <con:context/>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4033244834824711118-1f3091c5.1392ef032ed.-7ffd</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/SetConsignmentStateInOrder_1ResponseSBToNB"/>
                <con2:param name="externalDescription">
                  <con2:path>data($configXML/setConsignmentStateInOrder_1/externalDescription)</con2:path>
                </con2:param>
                <con2:param name="statusCode">
                  <con2:path>data($configXML/setConsignmentStateInOrder_1/statusCode)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="updateOredrCollectionStatusGateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate updateOrderCollectionStatus Request ">
        <con:comment>Validating  updateOrderCollectionStatus Request against NorthBoundInterfaces/manageorderdata_2_0.xsd</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2359128528684647591--7c882c5e.149cd05379a.-7f98</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:updateOrderCollectionStatus</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:updateOrderCollectionStatus</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Construct  updateOrderCollectionStatus Request">
        <con:comment>Constructing  the request to updateOrderCollectionStatus( ) Service from the ManageOrder: updateOrderCollectionStatus Request</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2359128528684647591--7c882c5e.149cd05379a.-7fc2</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                <con3:resource ref="ManageOrder_2_0/transformations/UpdateOrderCollectionStatusRQToUtilOrderCollectionStatusRQ"/>
                <con3:param name="configXml">
                  <con3:path>$configXML</con3:path>
                </con3:param>
                <con3:param name="updateOrderCollectionStatus">
                  <con3:path>$body/man:updateOrderCollectionStatus</con3:path>
                </con3:param>
                <con3:param name="header">
                  <con3:path>$incomingHeader</con3:path>
                </con3:param>
              </con3:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="GetOrderDetails_3 Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate GetOrderDetails_3 request">
        <con:comment>Validating the request of getOrderDetails_3 against its northbound schema.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2359128528684647591--7c882c5e.149cd05379a.-7fa0</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:getOrderDetails_3</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:getOrderDetails_3</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Saving the incoming request">
        <con:comment>Saving the incoming request</con:comment>
        <con:context/>
        <con:actions>
          <con2:assign varName="getOrderDetailsrequest">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-1107658138246821198--26b2cb52.15515732991.-7527</con3:id>
            <con2:expr>
              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
            </con2:expr>
          </con2:assign>
        </con:actions>
      </con:stage>
      <con:stage name="Request Validation">
        <con:context>
          <con4:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-631241811560695259-7bfc9ebe.15f6cf6ec06.-7fe7</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">(((data($body/man:getOrderDetails_3/man:retrieveAdditionalInfo/man:parameterName)=data($configXML/getOrderDetails_3/parameterName))and (data($body/man:getOrderDetails_3/man:retrieveAdditionalInfo/man:parameterName)=data($configXML/additionalPromotions)))
or ((data($body/man:getOrderDetails_3/man:retrieveAdditionalInfo/man:parameterName)=data($configXML/getOrderDetails_3/parameterName))and (data($body/man:getOrderDetails_3/man:retrieveAdditionalInfo/man:parameterName)=data($configXML/ParameterName))) 
or ((data($body/man:getOrderDetails_3/man:retrieveAdditionalInfo/man:parameterName)=data($configXML/getOrderDetails_3/parameterName))and (data($body/man:getOrderDetails_3/man:retrieveAdditionalInfo/man:parameterName)=data($configXML/refreshFinalPayment))))</con4:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:Error>
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-631241811560695259-7bfc9ebe.15f6cf6ec06.-7fb3</con4:id>
                  <con2:errCode>manageorder-36600-4501-V</con2:errCode>
                  <con2:message>The flag promotions is deprecated, please supply only the additionalPromotions in the request</con2:message>
                </con2:Error>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Constructing Request">
        <con:comment>Constructing Request</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:replace contents-only="true" varName="body">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7fe6</con3:id>
            <con2:location>
              <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
            </con2:location>
            <con2:expr>
              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                <con3:resource ref="ManageOrder_2_0/transformations/GetOrderDetails_3RQToutilGetOrderDetailsRQ"/>
                <con3:param name="configXML">
                  <con3:path>$configXML</con3:path>
                </con3:param>
                <con3:param name="getOrderDetails_3">
                  <con3:path>$body/man:getOrderDetails_3</con3:path>
                </con3:param>
                <con3:param name="header">
                  <con3:path>$incomingHeader</con3:path>
                </con3:param>
              </con3:xqueryTransform>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="GetOrderDetails_3 Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="CallToReferenceDetailService" errorHandler="_onErrorHandler-4766323174444255149-590132d7.152d44cf4eb.-757e">
        <con:comment>If additionalProductInfo is being passed in the request and CUKResponse gives PostpayTariffDetails.Then will make a call to ReferenceDetailsService else will construct Final Response for getOrderDetails_3 .</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/orderenquirydata_1" prefix="oed" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderdetailsdata_1" prefix="god" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/archiveorderenquirydata_1" prefix="aoe" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con3:userNsDecl namespace="http://soa.o2.co.uk/product/referencedetailsdata_1" prefix="ref" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:assign varName="CUKResponse" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-4766323174444255149-590132d7.152d44cf4eb.-7685</con3:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">If additionalProductInfo is being passed in the request and CUKResponse gives PostpayTariffDetails.Then will make a call to ReferenceDetailsService else will construct Final Response for getOrderDetails_3 .</con2:comment>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-4766323174444255149-590132d7.152d44cf4eb.-7629</con3:id>
            <con1:case>
              <con1:condition>
                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($incomingRequest/man:getOrderDetails_3/man:retrieveAdditionalInfo/man:parameterName)=data($configXML/ParameterName)
and
data($body/wmqi:companionMessage/wmqi:utilGetOrderDetailsResp/wmqi:uGOD_SaleProd/wmqi:uGOD_AssignedProduct/wmqi:uGOD_POT)</con3:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7faa</con3:id>
                  <con1:location>
                    <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                      <con3:resource ref="ManageOrder_2_0/transformations/UtilGetOrderDetailsRespToReferenceDetailServiceRQ"/>
                      <con3:param name="utilGetOrderDetailsResp">
                        <con3:path>$body/wmqi:companionMessage/wmqi:utilGetOrderDetailsResp</con3:path>
                      </con3:param>
                      <con3:param name="configXML">
                        <con3:path>$configXML</con3:path>
                      </con3:param>
                    </con3:xqueryTransform>
                  </con1:expr>
                </con1:replace>
                <con1:wsCallout>
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-4766323174444255149-590132d7.152d44cf4eb.-7625</con3:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="ReferenceDetailsService_1_0/proxyservices/ReferenceDetailsService_1_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>referenceDetails</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$header</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">referenceDetailsResp</con1:body>
                    <con1:header>header</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:javaCallout varName="">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-4766323174444255149-590132d7.152d44cf4eb.-7627</con3:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                      </con1:expr>
                    </con1:javaCallout>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:javaCallout varName="">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-4766323174444255149-590132d7.152d44cf4eb.-7626</con3:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$referenceDetailsResp</con2:xqueryText>
                      </con1:expr>
                    </con1:javaCallout>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="ConstructGetOrderDetails_3Response">
        <con:comment>Construct the northbound response for getOrderDetails_3 operation 
if non-zero orders being returned by utilGetOrderDetailsV5 or OrderEnquiry_1_0.getArchiveOrderDetails, 
otherwise raise error.</con:comment>
        <con:context>
          <con3:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:userNsDecl namespace="http://soa.o2.co.uk/product/referencedetailsdata_1" prefix="ref" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-4766323174444255149-590132d7.152d44cf4eb.-756c</con3:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                <con3:resource ref="ManageOrder_2_0/transformations/ConstructGetOrderDetails_3Response"/>
                <con3:param name="getOrderDetailsrequest">
                  <con3:path>$getOrderDetailsrequest/man:getOrderDetails_3</con3:path>
                </con3:param>
                <con3:param name="utilGetOrderDetailsResp">
                  <con3:path>$CUKResponse/wmqi:companionMessage/wmqi:utilGetOrderDetailsResp</con3:path>
                </con3:param>
                <con3:param name="configData">
                  <con3:path>$configXML</con3:path>
                </con3:param>
                <con3:param name="referenceDetailsResp">
                  <con3:path>if(fn:local-name($referenceDetailsResp/*[1])!='Fault' and data($referenceDetailsResp))then
$referenceDetailsResp
else 

&lt;ref:referenceDetailsResp/></con3:path>
                </con3:param>
              </con3:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-79239375595321023-29921892.12861827c5c.-7fea" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Handles UtilGetOrderDetails Fault">
        <con:comment>Handles the fault from UtilGetOrderDetails when 
fault code = CUK_6001_W</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Resume the flow if UtilGetOrderDetails return fault 
with faultCode CUK_6001_W(No Order found)</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-79239375595321023-29921892.12861827c5c.-7fe9</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($incomingRequest/man:getOrderDetails/man:isArchiveOrderRequired) = data($configXML/TrueValue)
and
fn:local-name($utilGetOrderDetailsResponse/*[1])='Fault'
and
data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/cukNoDetails)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con3:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c42</con3:id>
                  <con3:archive ref="Utility/o2framework/o2framework"/>
                  <con3:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con3:className>
                  <con3:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con3:method>
                  <con3:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                  </con3:expr>
                  <con3:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                  </con3:expr>
                  <con3:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                  </con3:expr>
                  <con3:expr>
                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$utilGetOrderDetailsResponse</con4:xqueryText>
                  </con3:expr>
                </con3:javaCallout>
                <con2:resume xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                  <con2:comment>Resume the flow if UtilGetOrderDetails return fault 
with faultCode CUK_6001_W</con2:comment>
                  <con2:id>_ActionId-79239375595321023-29921892.12861827c5c.-7fe8</con2:id>
                </con2:resume>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="SetConsignmentStateInOrder_1 Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate SetConsignmentStateInOrder_1 Request ">
        <con:comment>Validate setConsignmentStateInOrder_1 Request against the Northbound xsd</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4033244834824711118-1f3091c5.1392ef032ed.-7fff</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:setConsignmentStateInOrder_1</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:setConsignmentStateInOrder_1</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="Construct SetConsignmentStateInOrder_1 Request">
        <con:comment>Construct setConsignmentStateInOrder_1 request to invoke CUK backend</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4033244834824711118-1f3091c5.1392ef032ed.-7ffe</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                <con3:resource ref="ManageOrder_2_0/transformations/SetConsignmentStateInOrder_1RequestNBToSB"/>
                <con3:param name="SOATransactionId">
                  <con3:path>if(data($header/xcore:SOATransactionID)) then
		    data($header/xcore:SOATransactionID)
		   else ""</con3:path>
                </con3:param>
                <con3:param name="configXml">
                  <con3:path>$configXML</con3:path>
                </con3:param>
                <con3:param name="setConsignmentStateInOrder_1">
                  <con3:path>$body/man:setConsignmentStateInOrder_1</con3:path>
                </con3:param>
                <con3:param name="header">
                  <con3:path>$incomingHeader</con3:path>
                </con3:param>
              </con3:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="SubmitOrder Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct SubmitOrder Response">
        <con:comment>Construct the northbound response for SubmitOrder operation.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/submitinstallorderdata_1" prefix="sub" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-901413749672648104--3e71c9e4.127ad678d27.-7ffd</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="ManageOrder_2_0/transformations/SubmitInstallOrderRStoSubmitOrderRS"/>
                <con2:param name="submitInstallOrderResponse">
                  <con2:path>$submitInstallOrderResponse/sub:submitInstallOrderResponse</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="GetOrderList_3 Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct GetOrderList_3 Response">
        <con:comment>Construct the northbound response for getOrderList_3 operation.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderlistdata_1" prefix="gol" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/archiveorderenquirydata_1" prefix="aoe" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/orderenquirydata_1" prefix="oed" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6396924472143876578--3b753730.149ea2c8b2d.-7fff</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:count(data($body/wmqi:companionMessage/wmqi:utilGetOrderListV4Resp/cs:totalOrders)) = 0</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6396924472143876578--3b753730.149ea2c8b2d.-7ffd</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/UtilGetOrderListV4Resp_To_GetOrderList_3RS"/>
                      <con2:param name="configXml">
                        <con2:path>$configXML</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:replace varName="body" contents-only="true">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2359128528684647591--7c882c5e.149cd05379a.-7fa7</con2:id>
                <con1:location>
                  <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                </con1:location>
                <con1:expr>
                  <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                    <con2:resource ref="ManageOrder_2_0/transformations/UtilGetOrderListV4Resp_To_GetOrderList_3Response"/>
                    <con2:param name="configXml">
                      <con2:path>$configXML</con2:path>
                    </con2:param>
                    <con2:param name="utilGetOrderListV4Resp">
                      <con2:path>$body/wmqi:companionMessage/wmqi:utilGetOrderListV4Resp</con2:path>
                    </con2:param>
                    <con2:param name="getOrderListRequest">
                      <con2:path>$getOrderListRequest/man:getOrderList_3</con2:path>
                    </con2:param>
                  </con2:xqueryTransform>
                </con1:expr>
              </con1:replace>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="Common Logging Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Request Logging">
        <con:comment>Log all the request for different operations invoked in the service</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Masking the sensitive data in the incoming request.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3254965098909791908-705264fe.1281483763d.-7fff</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/man:submitOrder</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="maskedRequest">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3254965098909791908-705264fe.1281483763d.-8000</con2:id>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/MaskSubmitOrderRequest"/>
                      <con2:param name="submitOrder">
                        <con2:path>$body/man:submitOrder</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:assign>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/man:submitUpgradeOrder_1</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="maskedRequest">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8817565798719866703--36dfa5c2.132c87783d0.-7ff1</con2:id>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="ManageOrder_2_0/transformations/MaskingSubmitUpgradeOrderRequest"/>
                      <con2:param name="submitUpgradeOrder_1">
                        <con2:path>$body/man:submitUpgradeOrder_1</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:assign>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
          <con1:javaCallout varName="header" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8817565798719866703--36dfa5c2.132c87783d0.-8000</con2:id>
            <con1:archive ref="Utility/o2framework/o2framework"/>
            <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
            <con1:method>public static org.apache.xmlbeans.XmlObject logEntry(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
            </con1:expr>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
            </con1:expr>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if(data($maskedRequest/*))then
	$maskedRequest
else
	$body</con2:xqueryText>
            </con1:expr>
          </con1:javaCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Get Config Data">
        <con:comment>Retrive the config data and save the data in XML as well as save the incomming header.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:javaCallout varName="configData" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7ffa</con2:id>
            <con1:archive ref="Utility/configdatamanagement/configdatamanagement"/>
            <con1:className>uk.co.o2.soa.sf.xmldata.parsing.impl.ConfigFileManager</con1:className>
            <con1:method>public static java.lang.String retreiveServiceData(org.apache.xmlbeans.XmlObject)</con1:method>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
            </con1:expr>
          </con1:javaCallout>
          <con1:assign varName="configXML" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7ff9</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML($configData)/service-config-data/manageOrder_2_0</con2:xqueryText>
            </con1:expr>
          </con1:assign>
        </con:actions>
      </con:stage>
      <con:stage name="Store Input Context Variables">
        <con:comment>Stores the body and header for further usage</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:assign varName="incomingHeader" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7ff8</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="incomingRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5875112021626571551-7e455e97.1285d42cc63.-7ff5</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if($body/man:submitOrder) then
	''
else 
	$body</con2:xqueryText>
            </con1:expr>
          </con1:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="getOrderSummary_1_Gateway_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Validate getOrderSummary_1 request">
        <con:comment>Validating the request of getOrderSummary_1 against its northbound schema.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:validate xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4025728848178991902--51f17687.14e25c3951d.-8000</con2:id>
            <con1:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con1:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:getOrderSummary_1</con1:schemaElement>
            <con1:varName>body</con1:varName>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./man:getOrderSummary_1</con2:xpathText>
            </con1:location>
          </con1:validate>
        </con:actions>
      </con:stage>
      <con:stage name="saving_getOrderSummary_1_Request">
        <con:comment>saving getOrderSummary_1 request</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:assign varName="getOrderSummary_1Request" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4025728848178991902--51f17687.14e25c3951d.-7ffd</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/man:getOrderSummary_1</con2:xqueryText>
            </con1:expr>
          </con1:assign>
        </con:actions>
      </con:stage>
      <con:stage name="Checking_MSIDN_RetrieveAllOrders">
        <con:comment>Msisdn and retrieveallorders is Y or N</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="ns1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con3:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="ns0" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:userNsDecl prefix="soapenv" namespace="http://schemas.xmlsoap.org/soap/envelope/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="psc" namespace="http://soa.o2.co.uk/pscommonpostpaydata_2" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="cor" namespace="http://soa.o2.co.uk/coredata_1" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Checking if msisdn is passed or retrieveAllOrders is N
call utilGetOrderDetailsV5 or
if misdn and retrieveAllorders is Y first call utilGetOrderListV4
and based on thr no of orders the call will be made to 
utilGetOrderDetailsV5</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4025728848178991902--51f17687.14e25c3951d.-7ffe</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(fn:exists($getOrderSummary_1Request/man:msisdn)
and
fn:not($getOrderSummary_1Request/man:retrieveAllOrders))</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="test1">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7399721935931558635-267056d2.14e3eb28b90.-7f99</con2:id>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'1'</con2:xqueryText>
                  </con1:expr>
                </con1:assign>
                <con1:wsCallout>
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7e2f</con3:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="ManageOrder_2_0/proxyservices/LocalProxygetOrderDetails_3" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getOrderDetails_3</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$incomingHeader</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">GetOrderDetailsResp</con1:body>
                    <con1:header>incomingHeader</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:replace varName="body" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7e2b</con3:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/GetOrderSummary_1_GetOrderDetails_3_Request"/>
                          <con3:param name="getOrderSummary_1">
                            <con3:path>$getOrderSummary_1Request</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                    <con1:replace varName="header" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-77b2</con3:id>
                      <con1:location>
                        <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/HeaderNBtoSB"/>
                          <con3:param name="header">
                            <con3:path>$header</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                    <con1:javaCallout varName="">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7e29</con3:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                      </con1:expr>
                      <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                    <con3:transport-headers copy-all="false" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7e27</con4:id>
                      <con3:header-set>outbound-request</con3:header-set>
                      <con3:header name="applicationID" value="expression">
                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con4:xqueryText>
                      </con3:header>
                    </con3:transport-headers>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:javaCallout varName="">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7e25</con3:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$GetOrderDetailsResp</con3:xqueryText>
                      </con1:expr>
                      <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                    <con1:ifThenElse>
                      <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Checking If HAN is present in the response of utilGetOrderDetailsV5 ,
if not raise error.</con2:comment>
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7e1e</con3:id>
                      <con1:case>
                        <con1:condition>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($GetOrderDetailsResp/ns0:getOrderDetails_3Response/ns0:saleableProductDetails/ns0:assignedProduct/ns0:handsetDetails)!='0'</con3:xqueryText>
                        </con1:condition>
                        <con1:actions/>
                      </con1:case>
                      <con1:default>
                        <con1:Error>
                          <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7e1d</con3:id>
                          <con1:errCode>manageorder-36600-3000-E</con1:errCode>
                          <con1:message>No orders found for specified Order Number.</con1:message>
                        </con1:Error>
                      </con1:default>
                    </con1:ifThenElse>
                    <con1:replace varName="body" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7e1b</con3:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/getOrderDetailsResponseToGetOrderSummary_1"/>
                          <con3:param name="getOrderDetails_3Response">
                            <con3:path>$GetOrderDetailsResp/ns0:getOrderDetails_3Response</con3:path>
                          </con3:param>
                          <con3:param name="configXML">
                            <con3:path>$configXML</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(fn:exists($getOrderSummary_1Request/man:msisdn)
and
data($getOrderSummary_1Request/man:retrieveAllOrders)='N')</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="test2">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7b1d</con3:id>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'2'</con2:xqueryText>
                  </con1:expr>
                </con1:assign>
                <con1:wsCallout>
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7b1f</con3:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="ManageOrder_2_0/proxyservices/ManageOrder_2_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getOrderDetails_3</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$incomingHeader</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">GetOrderDetailsResp</con1:body>
                    <con1:header>incomingHeader</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:replace varName="body" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7b26</con3:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/GetOrderSummary_1_GetOrderDetails_3_Request"/>
                          <con3:param name="getOrderSummary_1">
                            <con3:path>$getOrderSummary_1Request</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                    <con1:replace varName="header" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-775c</con3:id>
                      <con1:location>
                        <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/HeaderNBtoSB"/>
                          <con3:param name="header">
                            <con3:path>$header</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                    <con1:javaCallout varName="">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7b25</con3:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                      </con1:expr>
                      <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                    <con3:transport-headers copy-all="false" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7b24</con4:id>
                      <con3:header-set>outbound-request</con3:header-set>
                      <con3:header name="applicationID" value="expression">
                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con4:xqueryText>
                      </con3:header>
                    </con3:transport-headers>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:javaCallout varName="">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7b23</con3:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$GetOrderDetailsResp</con3:xqueryText>
                      </con1:expr>
                      <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                    <con1:ifThenElse>
                      <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Checking If HAN is present in the response of utilGetOrderDetailsV5 ,
if not raise error.</con2:comment>
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7b22</con3:id>
                      <con1:case>
                        <con1:condition>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($GetOrderDetailsResp/ns0:getOrderDetails_3Response/ns0:saleableProductDetails/ns0:assignedProduct/ns0:handsetDetails)!='0'</con3:xqueryText>
                        </con1:condition>
                        <con1:actions/>
                      </con1:case>
                      <con1:default>
                        <con1:Error>
                          <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7b21</con3:id>
                          <con1:errCode>manageorder-36600-3000-E</con1:errCode>
                          <con1:message>No orders found for specified Order Number.</con1:message>
                        </con1:Error>
                      </con1:default>
                    </con1:ifThenElse>
                    <con1:replace varName="body" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-7b20</con3:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/getOrderDetailsResponseToGetOrderSummary_1"/>
                          <con3:param name="getOrderDetails_3Response">
                            <con3:path>$GetOrderDetailsResp/ns0:getOrderDetails_3Response</con3:path>
                          </con3:param>
                          <con3:param name="configXML">
                            <con3:path>$configXML</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(fn:exists($getOrderSummary_1Request/man:msisdn)
and
data($getOrderSummary_1Request/man:retrieveAllOrders)='Y')</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="test3">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7399721935931558635-267056d2.14e3eb28b90.-7f9b</con2:id>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'3'</con2:xqueryText>
                  </con1:expr>
                </con1:assign>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4025728848178991902--51f17687.14e25c3951d.-7ff0</con2:id>
                  <con1:service ref="ManageOrder_2_0/proxyservices/LocalProxygetOrderList_3" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getOrderList_3</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$incomingHeader</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">GetOrderListResp</con1:body>
                    <con1:header>incomingHeader</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4025728848178991902--51f17687.14e25c3951d.-7fe8</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/GetOrderSummary_1_GetOrderList_3_Request"/>
                          <con3:param name="getOrderSummary_1">
                            <con3:path>$getOrderSummary_1Request</con3:path>
                          </con3:param>
                          <con3:param name="configXML">
                            <con3:path>$configXML</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                    <con1:replace varName="header" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-7779</con3:id>
                      <con1:location>
                        <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/HeaderNBtoSB"/>
                          <con3:param name="header">
                            <con3:path>$header</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                    <con1:javaCallout varName="">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c52</con2:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                      </con1:expr>
                      <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                    <con3:transport-headers copy-all="false" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c51</con3:id>
                      <con3:header-set>outbound-request</con3:header-set>
                      <con3:header name="applicationID" value="expression">
                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($incomingHeader/cor:applicationID)</con4:xqueryText>
                      </con3:header>
                    </con3:transport-headers>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:javaCallout varName="">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c50</con2:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$GetOrderListResp</con:xqueryText>
                      </con1:expr>
                      <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                    <con1:ifThenElse>
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4025728848178991902--51f17687.14e25c3951d.-7f79</con2:id>
                      <con1:case>
                        <con1:condition>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($GetOrderListResp/man:getOrderList_3Response/man:orderList)!='0'</con3:xqueryText>
                        </con1:condition>
                        <con1:actions/>
                      </con1:case>
                      <con1:default>
                        <con1:Error>
                          <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4025728848178991902--51f17687.14e25c3951d.-7f70</con2:id>
                          <con1:errCode>manageorder-36600-3001-E</con1:errCode>
                          <con1:message>No orders found for specified MSISDN.</con1:message>
                        </con1:Error>
                      </con1:default>
                    </con1:ifThenElse>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:assign varName="GetFinalResp">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7399721935931558635-267056d2.14e3eb28b90.-7f8f</con2:id>
                  <con1:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">&lt;FinalResponse>&lt;/FinalResponse></con:xqueryText>
                  </con1:expr>
                </con1:assign>
                <con1:foreach>
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-76e5</con3:id>
                  <con1:variable>GetOrderListResp</con1:variable>
                  <con1:expression>
                    <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">./man:getOrderList_3Response/man:orderList/man:orders</con3:xpathText>
                  </con1:expression>
                  <con1:value-variable>orders</con1:value-variable>
                  <con1:index-variable>count</con1:index-variable>
                  <con1:total-variable>index</con1:total-variable>
                  <con1:actions>
                    <con1:wsCallout>
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-76c7</con3:id>
                      <con1:service ref="ManageOrder_2_0/proxyservices/LocalProxygetOrderDetails_3" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                      <con1:operation>getOrderDetails_3</con1:operation>
                      <con1:request>
                        <con1:body wrapped="true">$body</con1:body>
                        <con1:header>$incomingHeader</con1:header>
                      </con1:request>
                      <con1:response>
                        <con1:body wrapped="true">GetOrderDetailsResp1</con1:body>
                        <con1:header>incomingHeader</con1:header>
                      </con1:response>
                      <con1:requestTransform>
                        <con1:replace varName="body" contents-only="true">
                          <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-76d5</con3:id>
                          <con1:location>
                            <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                          </con1:location>
                          <con1:expr>
                            <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                              <con:resource ref="ManageOrder_2_0/transformations/GetOrderListResp_3ToGetOrderDetails"/>
                              <con:param name="Order">
                                <con:path>$orders</con:path>
                              </con:param>
                            </con:xqueryTransform>
                          </con1:expr>
                        </con1:replace>
                        <con1:replace varName="header" contents-only="true">
                          <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-768d</con3:id>
                          <con1:location>
                            <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                          </con1:location>
                          <con1:expr>
                            <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                              <con3:resource ref="ManageOrder_2_0/transformations/HeaderNBtoSB"/>
                              <con3:param name="header">
                                <con3:path>$header</con3:path>
                              </con3:param>
                            </con3:xqueryTransform>
                          </con1:expr>
                        </con1:replace>
                        <con1:javaCallout varName="">
                          <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-76d4</con3:id>
                          <con1:archive ref="Utility/o2framework/o2framework"/>
                          <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                          <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                          <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                          </con1:expr>
                          <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                          </con1:expr>
                          <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con:xqueryText>
                          </con1:expr>
                          <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                          </con1:expr>
                          <con1:return-param-as-ref>false</con1:return-param-as-ref>
                        </con1:javaCallout>
                        <con3:transport-headers copy-all="false" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                          <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-76d3</con4:id>
                          <con3:header-set>inbound-response</con3:header-set>
                          <con3:header name="applicationID" value="expression">
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con3:xqueryText>
                          </con3:header>
                        </con3:transport-headers>
                      </con1:requestTransform>
                      <con1:responseTransform>
                        <con1:javaCallout varName="">
                          <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-76d2</con3:id>
                          <con1:archive ref="Utility/o2framework/o2framework"/>
                          <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                          <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                          <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                          </con1:expr>
                          <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                          </con1:expr>
                          <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                          </con1:expr>
                          <con1:expr>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$GetOrderDetailsResp1</con3:xqueryText>
                          </con1:expr>
                          <con1:return-param-as-ref>false</con1:return-param-as-ref>
                        </con1:javaCallout>
                      </con1:responseTransform>
                    </con1:wsCallout>
                    <con1:insert varName="GetFinalResp">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-269820285408370546-789b702e.155007c0bea.-77e8</con3:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:where>last-child</con1:where>
                      <con1:expr>
                        <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$GetOrderDetailsResp1/man:getOrderDetails_3Response</con:xqueryText>
                      </con1:expr>
                    </con1:insert>
                  </con1:actions>
                </con1:foreach>
                <con1:ifThenElse>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2439314082491732877--4143a141.14eb0079ec0.-7fee</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($GetFinalResp/man:getOrderDetails_3Response/man:saleableProductDetails/man:assignedProduct/man:handsetDetails)!='0'</con:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:replace varName="body" contents-only="true">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7399721935931558635-267056d2.14e3eb28b90.-7f7f</con2:id>
                        <con1:location>
                          <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                        </con1:location>
                        <con1:expr>
                          <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                            <con:resource ref="ManageOrder_2_0/transformations/getOrderDetails_3ResponseToGetOrderSummary_1Response"/>
                            <con:param name="getOrderDetails_3Response">
                              <con:path>$GetFinalResp</con:path>
                            </con:param>
                            <con:param name="configXML">
                              <con:path>$configXML</con:path>
                            </con:param>
                          </con:xqueryTransform>
                        </con1:expr>
                      </con1:replace>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:Error>
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2439314082491732877--4143a141.14eb0079ec0.-7fec</con2:id>
                      <con1:errCode>manageorder-36600-3000-E</con1:errCode>
                      <con1:message>No orders found for specified Order Number.</con1:message>
                    </con1:Error>
                  </con1:default>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">(fn:exists($getOrderSummary_1Request/man:imei))</con3:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-79ed</con3:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="ManageOrder_2_0/proxyservices/ManageOrder_2_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getOrderDetails_3</con1:operation>
                  <con1:request>
                    <con1:body wrapped="true">$body</con1:body>
                    <con1:header>$incomingHeader</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body wrapped="true">GetOrderDetailsResp</con1:body>
                    <con1:header>incomingHeader</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:replace varName="body" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-79f4</con3:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/GetOrderSummary_1_GetOrderDetails_3_Request"/>
                          <con3:param name="getOrderSummary_1">
                            <con3:path>$getOrderSummary_1Request</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                    <con1:replace varName="header" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5990078523744314544--62b23b02.154f0fc90be.-7722</con3:id>
                      <con1:location>
                        <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/HeaderNBtoSB"/>
                          <con3:param name="header">
                            <con3:path>$header</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                    <con1:javaCallout varName="">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-79f3</con3:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                      </con1:expr>
                      <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                    <con3:transport-headers copy-all="false" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                      <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-79f2</con4:id>
                      <con3:header-set>outbound-request</con3:header-set>
                      <con3:header name="applicationID" value="expression">
                        <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con4:xqueryText>
                      </con3:header>
                    </con3:transport-headers>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:javaCallout varName="">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-79f1</con3:id>
                      <con1:archive ref="Utility/o2framework/o2framework"/>
                      <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                      <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                      </con1:expr>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$GetOrderDetailsResp</con3:xqueryText>
                      </con1:expr>
                      <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                    <con1:ifThenElse>
                      <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Checking If HAN is present in the response of utilGetOrderDetailsV5 ,
if not raise error.</con2:comment>
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-79f0</con3:id>
                      <con1:case>
                        <con1:condition>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($GetOrderDetailsResp/ns0:getOrderDetails_3Response/ns0:saleableProductDetails/ns0:assignedProduct/ns0:handsetDetails)!='0'</con3:xqueryText>
                        </con1:condition>
                        <con1:actions/>
                      </con1:case>
                      <con1:default>
                        <con1:Error>
                          <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-79ef</con3:id>
                          <con1:errCode>manageorder-36600-3000-E</con1:errCode>
                          <con1:message>No orders found for specified Order Number.</con1:message>
                        </con1:Error>
                      </con1:default>
                    </con1:ifThenElse>
                    <con1:replace varName="body" contents-only="true">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3128871105319267378--3862a24a.154e0d36856.-79ee</con3:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="ManageOrder_2_0/transformations/getOrderDetailsResponseToGetOrderSummary_1"/>
                          <con3:param name="getOrderDetails_3Response">
                            <con3:path>$GetOrderDetailsResp/ns0:getOrderDetails_3Response</con3:path>
                          </con3:param>
                          <con3:param name="configXML">
                            <con3:path>$configXML</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline name="_onErrorHandler-9206357943963450379--4705864e.12efb0d0494.-7fa0" type="error" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Handles UtilGetOrderDetails Fault">
        <con:comment>Handles the fault from UtilGetOrderDetails when 
fault code is 'utilgetorderdetails-9281-3000-E' or 'utilgetorderdetails-9281-3001-E'.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Resume the flow if the utilGetOrderDetails_2 operation returns the error 'utilgetorderdetails-9281-3000-E' or 'utilgetorderdetails-9281-3001-E' and isArchiveOrderRequired flag is present and set to true.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7fb1</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($incomingRequest/man:getOrderDetails_2/man:isArchiveOrderRequired) = data($configXML/TrueValue)
and
fn:local-name($utilGetOrderDetails_2Response/*[1])='Fault'
and
((data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForOrderNumber)) or (data($utilGetOrderDetails_2Response/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/getOrderDetails_2/noOrdersForMSISDN)))</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:javaCallout varName="">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ffa</con2:id>
                  <con1:archive ref="Utility/o2framework/o2framework"/>
                  <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                  <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                  </con1:expr>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$utilGetOrderDetails_2Response</con2:xqueryText>
                  </con1:expr>
                </con1:javaCallout>
                <con2:resume xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                  <con2:comment>Resume the flow if the utilGetOrderDetails_2 operation returns the error 'utilgetorderdetails-9281-3000-E' or 'utilgetorderdetails-9281-3001-E' and isArchiveOrderRequired flag is present and set to true.</con2:comment>
                  <con2:id>_ActionId-9206357943963450379--4705864e.12efb0d0494.-7ff9</con2:id>
                </con2:resume>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="GetOrderDetails Gateway_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Construct GetOrderdetails Response">
        <con:comment>Construct the northbound response for getOrderDetails operation
if non-zero orders being returned by UtilGetOrderDetails or 
GetArchiveOrderDetais
	else raise error</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/postpay/utilgetorderdetailsdata_1" prefix="god" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/orderenquirydata_1" prefix="oed" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="xcore" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check if the orders are present then construct the final response
else throw manageorder-36600-3001-E error.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3508874997276180786--30c260ca.12867e3b122.-8000</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($incomingRequest/man:getOrderDetails/man:isArchiveOrderRequired) = data($configXML/TrueValue)
and
data($utilGetOrderDetailsResponse/soap-env:Fault/detail/*/xcore:SOAFaultCode) = data($configXML/cukNoDetails)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:ifThenElse>
                  <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Check if the orders are present then construct the final response
else throw manageorder-36600-3001-E error.</con2:comment>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3508874997276180786--30c260ca.12867e3b122.-7ffc</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($getArchiveOrderDetailsResponse/oed:getArchiveOrderDetailsResponse/oed:orderCount) = data($configXML/ZeroValue)</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con2:Error xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fee</con3:id>
                        <con2:errCode>manageorder-36600-3001-E</con2:errCode>
                        <con2:message>No orders found for the given order identifier.</con2:message>
                      </con2:Error>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3508874997276180786--30c260ca.12867e3b122.-7ff9</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                          <con2:resource ref="ManageOrder_2_0/transformations/GetArchiveOrderDetailsRSToGetOrderDetailsRS"/>
                          <con2:param name="configXml">
                            <con2:path>$configXML</con2:path>
                          </con2:param>
                          <con2:param name="getArchiveOrderDetailsResponse">
                            <con2:path>$getArchiveOrderDetailsResponse/oed:getArchiveOrderDetailsResponse</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                  </con1:default>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con3:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con3:comment xmlns:con3="http://www.bea.com/wli/sb/stages/config">Check if the orders are present then construct the final response
else throw manageorder-36600-3001-E error.</con3:comment>
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fef</con3:id>
                <con3:case>
                  <con3:condition>
                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">fn:local-name($utilGetOrderDetailsResponse/god:utilGetOrderDetailsResponse/god:orderDetailsResponse/god:orderHeaderDetails)
and
fn:local-name($utilGetOrderDetailsResponse/god:utilGetOrderDetailsResponse/god:orderDetailsResponse/god:orderDetails)</con4:xqueryText>
                  </con3:condition>
                  <con3:actions>
                    <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5717877515595668264--4685988c.1279332c8f0.-7fe4</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                          <con2:resource ref="ManageOrder_2_0/transformations/UtilGetOrderDetailsRSToGetOrderDetailsRS"/>
                          <con2:param name="utilGetOrderDetailsResponse">
                            <con2:path>$utilGetOrderDetailsResponse/god:utilGetOrderDetailsResponse</con2:path>
                          </con2:param>
                          <con2:param name="configData">
                            <con2:path>$configXML</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:replace>
                  </con3:actions>
                </con3:case>
                <con3:default>
                  <con3:Error>
                    <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c5f</con3:id>
                    <con3:errCode>manageorder-36600-3001-E</con3:errCode>
                    <con3:message>No orders found for the given order identifier.</con3:message>
                  </con3:Error>
                </con3:default>
              </con3:ifThenElse>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con1:pipeline type="request" name="ConfirmOrderTradeInCollection _1_Gateway_request">
      <con1:stage name="Validate ConfirmOrderTradeInCollection _1  Request ">
        <con1:comment>Validating ConfirmOrderTradeInCollection _1 Request against NorthBoundInterfaces/manageorderdata_2_0.xsd</con1:comment>
        <con1:context>
          <con:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man"/>
        </con1:context>
        <con1:actions>
          <con2:validate>
            <con:id>_ActionId-3358752805560110968--2228c508.1554e62e70b.-798e</con:id>
            <con2:schema ref="NorthBoundInterfaces/manageorderdata_2_0"/>
            <con2:schemaElement xmlns:man="http://soa.o2.co.uk/manageorderdata_2">man:confirmOrderTradeInCollection_1</con2:schemaElement>
            <con2:varName>body</con2:varName>
            <con2:location>
              <con:xpathText>./man:confirmOrderTradeInCollection_1</con:xpathText>
            </con2:location>
          </con2:validate>
        </con1:actions>
      </con1:stage>
      <con1:stage name="Construct utilConfirmDeviceReturned Request">
        <con1:comment>Constructing  the request to utilConfirmDeviceReturned( ) Service from the ManageOrder:ConfirmOrderTradeInCollection _1  Request.</con1:comment>
        <con1:context>
          <con:varNsDecl namespace="http://soa.o2.co.uk/manageorderdata_2" prefix="man"/>
        </con1:context>
        <con1:actions>
          <con2:replace varName="body" contents-only="true">
            <con:id>_ActionId-3358752805560110968--2228c508.1554e62e70b.-7977</con:id>
            <con2:location>
              <con:xpathText>.</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryTransform>
                <con:resource ref="ManageOrder_2_0/transformations/ConfirmOrderTradeInCollection_1RQ"/>
                <con:param name="confirmOrderTradeInCollection_1">
                  <con:path>$body/man:confirmOrderTradeInCollection_1</con:path>
                </con:param>
                <con:param name="configXml">
                  <con:path>$configXML</con:path>
                </con:param>
                <con:param name="header">
                  <con:path>$header</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:replace>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="response" name="ConfirmOrderTradeInCollection _1_Gateway_response">
      <con1:stage name="Construct ConfirmOrderTradeInCollection _1Response">
        <con1:comment>Constructing ConfirmOrderTradeInCollection _1Response from utilConfirmDeviceReturnedResponse.</con1:comment>
        <con1:context>
          <con:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="com"/>
          <con:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi"/>
        </con1:context>
        <con1:actions>
          <con2:ifThenElse>
            <con:comment>If "acceptStatus" is coming from 'UTIL_Confirm_DeviceReturnedResponse', then constructing final response
else raising the fault explicitly.</con:comment>
            <con:id>_ActionId-3358752805560110968--2228c508.1554e62e70b.-7819</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>data($body/wmqi:companionMessage/wmqi:utilConfirmDeviceReturnedResp/com:acceptStatus)="SUCCESSFUL"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                  <con:id>_ActionId-3358752805560110968--2228c508.1554e62e70b.-778d</con:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con:xqueryTransform>
                      <con:resource ref="ManageOrder_2_0/transformations/ConfirmOrderTradeInCollection_1RS"/>
                      <con:param name="configXML">
                        <con:path>$configXML</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con1:expr>
                </con1:replace>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con1:Error xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3358752805560110968--2228c508.1554e62e70b.-7643</con4:id>
                <con1:errCode>errorCode</con1:errCode>
                <con1:message>errorDescription.</con1:message>
              </con1:Error>
            </con2:default>
          </con2:ifThenElse>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con:flow xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:pipeline-node name="Common Logging Gateway">
        <con:comment>The common logging gateway, log all the requests and responses as well as
fetch the service-config.xml and save the incomming header.</con:comment>
        <con:request>Common Logging Gateway_request</con:request>
        <con:response>Common Logging Gateway_response</con:response>
      </con:pipeline-node>
      <con:branch-node type="operation" name="ManageOrder_2_0 Branch">
        <con:comment>ManageOrder Business Service allows retrieving a list of orders 
as well as the details of a given order that is present in the order 
management system. The service has also added the operation for 
submitting new orders.</con:comment>
        <con:context/>
        <con:branch-table>
          <con:branch name="getOrderDetails">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="GetOrderDetails Gateway">
                <con:comment>getOrderDetails is an operation that retrieves the details of an order, if an order is associated with one of the 
following order identifiers,
* Order Number or
* Msisdn that is either Postpay, Prepay and msisdn that is either in active or inactive state;
This operation is also capable of retrieving an archive order if the consuming client requests for it and if any 
exist on the archival platform for the above 2 order identifiers.
However if for the above 2 order identifiers if any order exists on the non-archive ordering platform then even
if the consuming client has requested for an archive order, the existing non-archive order would be retrieved.</con:comment>
                <con:request>GetOrderDetails Gateway_request</con:request>
                <con:response>GetOrderDetails Gateway_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:branch name="getOrderList">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="GetOrderList Gateway">
                <con:comment>getOrderList is an operation that retrieves a list of orders in a chronologically descending
order if one or more orders are associated with one of the following order identifiers,
* User portal Id that is either in active or inactive state; or
* Orange customer number or
* Msisdn that is either Postpay, Prepay and msisdn that is either in active or inactive state; 
This operation also supports the retrieval of archived orders if opted for by the 
consuming client and only if the input is a Msisdn.</con:comment>
                <con:request>GetOrderList Gateway_request</con:request>
                <con:response>GetOrderList Gateway_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:branch name="submitOrder">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="SubmitOrder Gateway">
                <con:comment>This operation allows submitting a new hardware order and returns status of the order acceptance.
If the operation is unable place the order for any reason then a fault will be thrown with appropriate error codes.</con:comment>
                <con:request>SubmitOrder Gateway_request</con:request>
                <con:response>SubmitOrder Gateway_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:branch name="getOrderList_2">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="GetOrderList_2 Gateway">
                <con:comment>GetOrderList_2 operation retrieves a list of orders alongwith the earlyupgrade fee 
in a chronologically descending order if one or more orders are associated with one 
of the following order identifiers,
      User portal Id that is either in active or inactive state; 
      or the portal domain is an optional element. 
      If the portal domain is not passed a preconfigured value should be passed to CUK.
	Orange customer number or
	Msisdn that is either Postpay, Prepay 
	and msisdn that is either in active or inactive state; 

This operation also supports the retrieval of archived orders 
if opted for by the consuming client and only if the input is a Msisdn.</con:comment>
                <con:request>GetOrderList_2 Gateway_request</con:request>
                <con:response>GetOrderList_2 Gateway_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:branch name="getOrderDetails_2">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="GetOrderDetails_2 Gateway">
                <con:comment>GetOrderDetails_2 operation retrieves the details of an order alongwith the early upgrade details, if an order is associated with one of the following order identifiers,
	Order Number or
	Msisdn that is either Postpay, Prepay and msisdn that is either in active or inactive state;
This operation is also capable of retrieving an archive order if the consuming client requests for it and if any exist on the archival platform for the above 2 order identifiers.
However if for the above 2 order identifiers if any order exists on the non-archive ordering platform then even if the consuming client has requested for an archive order, the existing non-archive order would be retrieved.</con:comment>
                <con:request>GetOrderDetails_2 Gateway_request</con:request>
                <con:response>GetOrderDetails_2 Gateway_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:branch name="submitUpgradeOrder_1">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="SubmitUpgradeOrder_1 Gateway">
                <con:comment>This operation is used to submit a request to upgrade an existing customer's mobile contract for a given MSISDN. An upgrade must include a new handset or a new tariff or an adjustment. This operation supports postpay consumer upgrades only.</con:comment>
                <con:request>SubmitUpgradeOrder_1 Gateway_request</con:request>
                <con:response>SubmitUpgradeOrder_1 Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Route To CukMqRouter.utilSubmitUpgradeOrder operation">
                <con:comment>Route the message to the CukMqRouter which intern calls CUK backend.</con:comment>
                <con:context>
                  <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="cor" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3356296894646496594--4bbbaa17.1328aa43423.-7ffd</con2:id>
                    <con1:service ref="CukMqRouter/proxyservices/CukMqRouter_1_0" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con1:outboundTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c3c</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$maskedRequest/*</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:transport-headers>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c3b</con3:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="applicationID" value="expression">
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con3:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con1:outboundTransform>
                    <con1:responseTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c3a</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:ifThenElse>
                        <con3:comment xmlns:con3="http://www.bea.com/wli/sb/stages/config">Check for error from CUK,if so, send the control to error handler</con3:comment>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6666960733634655815-2c406d77.1274c061c62.-7ff8</con3:id>
                        <con2:case>
                          <con2:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body/wmqi:companionMessage/cs:errorReport</con3:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:Error>
                              <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6666960733634655815-2c406d77.1274c061c62.-7ff7</con3:id>
                              <con2:errCode>Error</con2:errCode>
                              <con2:message>Error has occured from backend. Send the control to error handler</con2:message>
                            </con2:Error>
                          </con2:actions>
                        </con2:case>
                        <con2:default/>
                      </con2:ifThenElse>
                    </con1:responseTransform>
                  </con1:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="getDeliveryOptions_1">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="GetDeliveryOptions_1 Gateway">
                <con:comment>This operation retrieves the flexible delivery options information for a given order type and intended delivery postcode.</con:comment>
                <con:request>GetDeliveryOptions_1 Gateway_request</con:request>
                <con:response>GetDeliveryOptions_1 Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Route To CukMqRouter.utilGetDeliveryOptions operation">
                <con:comment>Route the message to the CukMqRouter which intern calls CUK backend.</con:comment>
                <con:context>
                  <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="cor" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c39</con2:id>
                    <con1:service ref="CukMqRouter/proxyservices/CukMqRouter_1_0" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con1:outboundTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c38</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:transport-headers>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c37</con3:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="applicationID" value="expression">
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con3:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con1:outboundTransform>
                    <con1:responseTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c36</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:ifThenElse>
                        <con3:comment xmlns:con3="http://www.bea.com/wli/sb/stages/config">Check for error from CUK,if so, send the control to error handler</con3:comment>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c35</con3:id>
                        <con2:case>
                          <con2:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body/wmqi:companionMessage/cs:errorReport</con3:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:Error>
                              <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c34</con3:id>
                              <con2:errCode>Error</con2:errCode>
                              <con2:message>Error has occured from backend. Send the control to error handler</con2:message>
                            </con2:Error>
                          </con2:actions>
                        </con2:case>
                        <con2:default/>
                      </con2:ifThenElse>
                    </con1:responseTransform>
                  </con1:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="setConsignmentStateInOrder_1">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="SetConsignmentStateInOrder_1 Gateway">
                <con:comment>This operation is to set/update the status of the consignment/despatch in an order by retail systems.</con:comment>
                <con:request>SetConsignmentStateInOrder_1 Gateway_request</con:request>
                <con:response>SetConsignmentStateInOrder_1 Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Route To CukMqRouter.utilUpdateConsignmentStatus operation">
                <con:comment>Route the message to the CukMqRouter which intern calls CUK backend.</con:comment>
                <con:context>
                  <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="cor" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4033244834824711118-1f3091c5.1392ef032ed.-8000</con2:id>
                    <con1:service ref="CukMqRouter/proxyservices/CukMqRouter_1_0" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con1:outboundTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c33</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:transport-headers>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c32</con3:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="applicationID" value="expression">
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con3:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con1:outboundTransform>
                    <con1:responseTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c31</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:ifThenElse>
                        <con3:comment xmlns:con3="http://www.bea.com/wli/sb/stages/config">Check for error from CUK,if so, send the control to error handler</con3:comment>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c30</con3:id>
                        <con2:case>
                          <con2:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body/wmqi:companionMessage/cs:errorReport</con3:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:Error>
                              <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c2f</con3:id>
                              <con2:errCode>Error</con2:errCode>
                              <con2:message>Error has occured from backend. Send the control to error handler</con2:message>
                            </con2:Error>
                          </con2:actions>
                        </con2:case>
                        <con2:default/>
                      </con2:ifThenElse>
                    </con1:responseTransform>
                  </con1:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="getConsignmentDetails_1">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="GetConsignmentDetails_1 Gateway">
                <con:comment>This operation is to retrieve consignment details for a given order number, consignment number or store number.</con:comment>
                <con:request>GetConsignmentDetails_1 Gateway_request</con:request>
                <con:response>GetConsignmentDetails_1 Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Route To CukMqRouter.utilGetConsignmentDetails operation">
                <con:comment>Route the message to the CukMqRouter which intern calls CUK backend.</con:comment>
                <con:context>
                  <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="cor" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7610802886273542248-3e91fc36.1399f868873.-8000</con2:id>
                    <con1:service ref="CukMqRouter/proxyservices/CukMqRouter_1_0" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con1:outboundTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c2e</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:transport-headers>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c2d</con3:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="applicationID" value="expression">
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con3:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con1:outboundTransform>
                    <con1:responseTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c2c</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:ifThenElse>
                        <con3:comment xmlns:con3="http://www.bea.com/wli/sb/stages/config">Check for error from CUK,if so, send the control to error handler</con3:comment>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c2b</con3:id>
                        <con2:case>
                          <con2:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body/wmqi:companionMessage/cs:errorReport</con3:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:Error>
                              <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c2a</con3:id>
                              <con2:errCode>Error</con2:errCode>
                              <con2:message>Error has occured from backend. Send the control to error handler</con2:message>
                            </con2:Error>
                          </con2:actions>
                        </con2:case>
                        <con2:default/>
                      </con2:ifThenElse>
                    </con1:responseTransform>
                  </con1:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="confirmOrderPayment_1">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="ConfirmOrderPayment_1 Gateway">
                <con:comment>This operation is used to inform that payment of an order previously submitted has been taken. 
Orders that are submitted prior to payment being taken may move into a 'paused' state until payment is completed.</con:comment>
                <con:request>ConfirmOrderPayment_1 Gateway_request</con:request>
                <con:response>ConfirmOrderPayment_1 Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Route to CukMqRouter for utilConfirmOrderPayment">
                <con:comment>Invoking CukMqRouter to get the response of utilConfirmOrderPayment Service.</con:comment>
                <con:context>
                  <con3:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="cor" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5080115100900476550-2de44530.1403e5b383d.-7fee</con2:id>
                    <con1:service ref="CukMqRouter/proxyservices/CukMqRouter_1_0" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con1:outboundTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8639949585760639955--6acd0ac7.1403dbd7229.-7ffa</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:transport-headers>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6308740819447857978-3bcc83f7.154050b55b1.-7f62</con3:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="applicationID" value="expression">
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con3:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con1:outboundTransform>
                    <con1:responseTransform>
                      <con2:replace varName="header">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8639949585760639955--6acd0ac7.1403dbd7229.-7ffe</con3:id>
                        <con2:location>
                          <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                      </con2:replace>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8639949585760639955--6acd0ac7.1403dbd7229.-7ffc</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$header</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                    </con1:responseTransform>
                  </con1:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="updateOrderCollectionStatus">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="updateOredrCollectionStatusGateway">
                <con:comment>This operation allows a client to update the collection status and hardware data for Click and Collect Now orders.</con:comment>
                <con:request>updateOredrCollectionStatusGateway_request</con:request>
                <con:response>updateOredrCollectionStatusGateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Route to CukMqRouter for updateOrderCollectionStatus">
                <con:comment>Invoking CukMqRouter to get the response of utilUpdateOrderCollectionStatus Service.</con:comment>
                <con:context>
                  <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="cor" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2359128528684647591--7c882c5e.149cd05379a.-7fba</con2:id>
                    <con1:service ref="CukMqRouter/proxyservices/CukMqRouter_1_0" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con1:outboundTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c29</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:transport-headers>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c28</con3:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="applicationID" value="expression">
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con3:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con1:outboundTransform>
                    <con1:responseTransform>
                      <con2:javaCallout varName="">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c27</con3:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:ifThenElse>
                        <con3:comment xmlns:con3="http://www.bea.com/wli/sb/stages/config">Check for error from CUK,if so, send the control to error handler</con3:comment>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c26</con3:id>
                        <con2:case>
                          <con2:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body/wmqi:companionMessage/cs:errorReport</con3:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:Error>
                              <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c25</con3:id>
                              <con2:errCode>Error</con2:errCode>
                              <con2:message>Error has occured from backend. Send the control to error handler</con2:message>
                            </con2:Error>
                          </con2:actions>
                        </con2:case>
                        <con2:default/>
                      </con2:ifThenElse>
                    </con1:responseTransform>
                  </con1:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="getOrderList_3">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="GetOrderList_3 Gateway">
                <con:comment>This operation provides a list of orders associated with a customers common registration portal id, msisdn ,customer number,parcel number,store number or customer surname.
This operation would also be able to retrieve archive orders given a msisdn as input. hardware data for Click and Collect Now orders.</con:comment>
                <con:request>GetOrderList_3 Gateway_request</con:request>
                <con:response>GetOrderList_3 Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Call to CUK Backend">
                <con:comment>Constructs utilGetOrderList_3 request and 
invokes utilGetOrderListV4 operation 
and logs the outbound and inbound respectively.</con:comment>
                <con:context>
                  <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="cor" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3382475532129327546--28fd4e43.149d138a770.-8000</con2:id>
                    <con1:service ref="CukMqRouter/proxyservices/CukMqRouter_1_0" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con1:outboundTransform>
                      <con1:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c24</con2:id>
                        <con1:archive ref="Utility/o2framework/o2framework"/>
                        <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                        <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                        </con1:expr>
                      </con1:javaCallout>
                      <con2:transport-headers>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c23</con3:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="applicationID" value="expression">
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con3:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con1:outboundTransform>
                    <con1:responseTransform>
                      <con1:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c22</con2:id>
                        <con1:archive ref="Utility/o2framework/o2framework"/>
                        <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                        <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                        </con1:expr>
                      </con1:javaCallout>
                      <con2:ifThenElse>
                        <con3:comment xmlns:con3="http://www.bea.com/wli/sb/stages/config">Check for error from CUK,if so, send the control to error handler</con3:comment>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c21</con3:id>
                        <con2:case>
                          <con2:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body/wmqi:companionMessage/cs:errorReport</con3:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:Error>
                              <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c20</con3:id>
                              <con2:errCode>Error</con2:errCode>
                              <con2:message>Error has occured from backend. Send the control to error handler</con2:message>
                            </con2:Error>
                          </con2:actions>
                        </con2:case>
                        <con2:default/>
                      </con2:ifThenElse>
                    </con1:responseTransform>
                  </con1:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="getOrderDetails_3">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="GetOrderDetails_3 Gateway">
                <con:comment>GetOrderDetails_3 operation retrieve with the early upgrade details, if an order is associated with one of the following order identifiers,
	Order Number or
	Msisdn that is either Postpay, Prepay and msisdn that is either in active or inactive state;
This operation is also capable of retrieving an archive order if the consuming client requests for it and if any exist on the archival platform for the above 2 order identifiers.
However if for the above 2 order identifiers if any order exists on the non-archive ordering platform then even if the consuming client has requested for an archive order, the existing non-archive order would be retrieved.</con:comment>
                <con:request>GetOrderDetails_3 Gateway_request</con:request>
                <con:response>GetOrderDetails_3 Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Call To CUK.utilGetOrderDetails">
                <con:comment>ConstructsutilGetOrderDetails request
and logs the outbound and inbound respectively.</con:comment>
                <con:context>
                  <con1:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="cor" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://WMQIServices.eai.o2c.ibm.com" prefix="wmqi" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                  <con1:userNsDecl namespace="http://companion.eai.o2c.ibm.com" prefix="cs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8220930525041485607--21097eda.149d04cd8c7.-7ffb</con2:id>
                    <con1:service ref="CukMqRouter/proxyservices/CukMqRouter_1_0" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con1:outboundTransform>
                      <con1:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c1f</con2:id>
                        <con1:archive ref="Utility/o2framework/o2framework"/>
                        <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                        <con1:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                        </con1:expr>
                      </con1:javaCallout>
                      <con2:transport-headers>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c1e</con3:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="applicationID" value="expression">
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con3:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con1:outboundTransform>
                    <con1:responseTransform>
                      <con2:replace varName="header">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3167795675311341194--4de00e7f.149ff58477e.-7fff</con3:id>
                        <con2:location>
                          <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                      </con2:replace>
                      <con1:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c1d</con2:id>
                        <con1:archive ref="Utility/o2framework/o2framework"/>
                        <con1:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con1:className>
                        <con1:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con1:method>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$outbound</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
                        </con1:expr>
                      </con1:javaCallout>
                      <con2:replace varName="body" contents-only="true">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2482678351284906082-4d93a773.14a192350a6.-8000</con3:id>
                        <con2:location>
                          <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                            <con3:resource ref="ManageOrder_2_0/MaskCardNumber"/>
                            <con3:param name="request">
                              <con3:path>$body/wmqi:companionMessage</con3:path>
                            </con3:param>
                          </con3:xqueryTransform>
                        </con2:expr>
                      </con2:replace>
                      <con2:ifThenElse>
                        <con3:comment xmlns:con3="http://www.bea.com/wli/sb/stages/config">Check for error from CUK,if so, send the control to error handler</con3:comment>
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c1c</con3:id>
                        <con2:case>
                          <con2:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body/wmqi:companionMessage/cs:errorReport</con3:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:Error>
                              <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5983216199004302883--cd7093f.14e8b444351.-6c1b</con3:id>
                              <con2:errCode>Error</con2:errCode>
                              <con2:message>Error has occured from backend. Send the control to error handler</con2:message>
                            </con2:Error>
                          </con2:actions>
                        </con2:case>
                        <con2:default/>
                      </con2:ifThenElse>
                    </con1:responseTransform>
                  </con1:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="getOrderSummary_1">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="getOrderSummary_1_Gateway">
                <con:request>getOrderSummary_1_Gateway_request</con:request>
                <con:response>getOrderSummary_1_Gateway_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:branch name="confirmOrderTradeInCollection_1">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="ConfirmOrderTradeInCollection _1_Gateway">
                <con:comment>This operation allows a client to inform EAI that a device that is part of an order trade in, typically for a customer promotion, has been returned.</con:comment>
                <con:request>ConfirmOrderTradeInCollection _1_Gateway_request</con:request>
                <con:response>ConfirmOrderTradeInCollection _1_Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Route to CukMqRouter for utilConfirmDeviceReturned operation">
                <con:comment>Invoking CukMqRouter to get the response of utilConfirmDeviceReturned Service.</con:comment>
                <con:context>
                  <con4:userNsDecl namespace="http://soa.o2.co.uk/coredata_1" prefix="cor" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con3:route>
                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3358752805560110968--2228c508.1554e62e70b.-7944</con4:id>
                    <con3:service ref="CukMqRouter/proxyservices/CukMqRouter_1_0" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con3:outboundTransform>
                      <con2:javaCallout varName="">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3358752805560110968--2228c508.1554e62e70b.-7931</con4:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logOutbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$inbound</con4:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$outbound</con4:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con4:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$body</con4:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:transport-headers xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3358752805560110968--2228c508.1554e62e70b.-78db</con4:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="applicationID" value="expression">
                          <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($header/cor:applicationID)</con4:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con3:outboundTransform>
                    <con3:responseTransform>
                      <con2:javaCallout varName="" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3358752805560110968--2228c508.1554e62e70b.-7833</con4:id>
                        <con2:archive ref="Utility/o2framework/o2framework"/>
                        <con2:className>uk.co.o2.soa.sf.o2fwk.impl.O2Framework</con2:className>
                        <con2:method>public static void logInbound(org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject, org.apache.xmlbeans.XmlObject)</con2:method>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$inbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$outbound</con3:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con4:xqueryText>
                        </con2:expr>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                        </con2:expr>
                      </con2:javaCallout>
                      <con2:replace varName="header" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3358752805560110968--2228c508.1554e62e70b.-7887</con4:id>
                        <con2:location>
                          <con3:xpathText xmlns:con3="http://www.bea.com/wli/sb/stages/config">.</con3:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$incomingHeader</con3:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con3:responseTransform>
                  </con3:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:default-branch>
            <con:flow/>
          </con:default-branch>
        </con:branch-table>
      </con:branch-node>
    </con:flow>
  </ser:router>
</xml-fragment>